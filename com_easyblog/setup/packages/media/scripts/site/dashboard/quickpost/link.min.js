EasyBlog.module("site/dashboard/quickpost/link",function(n){EasyBlog.Controller("Quickpost.Form.Link",{defaultOptions:{"{crawl}":"[data-quickpost-crawl-link]","{loader}":"[data-quickpost-crawl-loader]","{form}":"[data-quickpost-form]","{link}":"[data-quickpost-link]","{preview}":"[data-quickpost-link-preview]","{uploadContainer}":"[data-link-upload-container]","{imagePreview}":"[data-link-image-preview]","{uploadButton}":"[data-link-photo-upload]","{useOriginalButton}":"[data-link-photo-original]","{imageUploadLoader}":"[data-link-image-loader]","{imageUri}":"[data-link-photo-uri]","{imageUriExternal}":"[data-link-photo-external]",originalImageUrl:null,"{title}":"[data-quickpost-title]","{content}":"[data-quickpost-content]","{tags}":"[data-quickpost-tags]","{privacy}":"[data-quickpost-privacy]","{category}":"[data-quickpost-category]","{tagSuggest}":"[data-quickpost-form][data-type='link'] [data-eb-composer-tags]"}},function(o,l){return{init:function(){var i=o.uploadContainer().plupload2({},!1);i.init(),i.bind("FilesAdded",function(a,e){i.start(),o.toggleFileUploadLoading()}),i.bind("FileUploaded",o.fileUploaded),o.parent.implementTags(o.tagSuggest())},createImageTag:function(a){var e=new Image;return n(e).attr("src",a),e},toggleFileUploadLoading:function(){o.uploadContainer().toggleClass("hidden"),o.imageUploadLoader().toggleClass("hidden")},fileUploaded:function(a,e,i){o.toggleFileUploadLoading();var t=JSON.parse(i.response);console.log(t);i=t.media,t=i.meta.url;"/"!=t.charAt(0)&&(t="/"+t);t=o.createImageTag(t);o.imageUri().val(i.uri),o.showPreview(t)},showPreview:function(a){o.uploadContainer().addClass("hidden"),o.imagePreview().removeClass("hidden").html(a)},"{uploadButton} click":function(a,e){o.uploadContainer().removeClass("hidden"),o.imagePreview().addClass("hidden").html(""),o.imageUriExternal().val("")},"{useOriginalButton} click":function(a,e){var i=o.createImageTag(l.originalImageUrl);o.imageUriExternal().val(l.originalImageUrl),o.uploadContainer().addClass("hidden"),o.imagePreview().removeClass("hidden").html(i)},"{crawl} click":function(a,e){e.preventDefault();var t=o.link().val();form=n(a).parents(o.form.selector),o.loader().removeClass("hidden"),EasyBlog.ajax("site/views/crawler/crawl",{url:t}).done(function(a){o.loader().addClass("hidden");var e=a[t],i=e.description,a=e.title;form.find(o.title.selector).val(a),form.find(o.content.selector).val(i),e.opengraph.image&&(i=new Image,l.originalImageUrl=e.opengraph.image,n(i).attr("src",e.opengraph.image),form.find(o.imagePreview.selector).html(i),o.imageUriExternal().val(l.originalImageUrl),o.useOriginalButton().removeClass("hidden"),form.find(o.uploadContainer.selector).addClass("hidden")),e.opengraph.image||(form.find(o.uploadContainer.selector).removeClass("hidden"),form.find(o.imagePreview.selector).addClass("hidden"),o.useOriginalButton().addClass("hidden")),o.preview().removeClass("hide")})},"{self} onPublishQuickPost":function(a,e,i,t,l){"link"==t&&(o.tagSuggest().controller().fillTags(),i.data={title:n(l).find(o.title.selector).val(),type:"link",content:n(l).find(o.content.selector).val(),link:n(l).find(o.link.selector).val(),tags:n(l).find(o.tags.selector).val(),privacy:n(l).find(o.privacy.selector).val(),category:n(l).find(o.category.selector).val()},0<(l=o.imageUriExternal().val()).length&&(i.data.externalImage=l),0<o.imageUri().val().length&&(i.data.internalImage=o.imageUri().val()))},"{self} onClearForm":function(a,e,i,t,l){"link"==t&&(o.tagSuggest().controller().clearTags(),n(l).find(o.title.selector).val(""),n(l).find(o.content.selector).val(""),n(l).find(o.link.selector).val(""),n(l).find(o.tags.selector).val(""),o.preview().addClass("hide"))}}}),this.resolve()});