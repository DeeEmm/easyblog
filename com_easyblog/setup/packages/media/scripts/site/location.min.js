EasyBlog.module("site/location",function(o){var a=this;EasyBlog.require().script("site/vendors/ratings").done(function(d){EasyBlog.Controller("Location.Map",{defaultOptions:{animation:"drop",language:"en",useStaticMap:!1,disableMapsUI:!0,zoom:5,fitBounds:null,minZoom:null,maxZoom:null,center:null,locations:[],mapType:"ROADMAP",width:500,height:400,enableClusterer:!1,"{locationMap}":".locationMap"}},function(g){return{init:function(){g.mapLoaded=!1;var o=d.uid("ext");window[o]=function(){d.___GoogleMaps.resolve()};var a,n,e,t,i,s,p,l,r=g.options.gMapsKey;EasyBlog.require().script("site/markerclusterer"),1==g.options.useStaticMap?(a="&language="+String(g.options.language),n="&size="+String(g.options.width)+"x"+String(g.options.height),e="&zoom="+String(g.options.zoom),t="&center="+String(parseFloat(g.options.locations[0].latitude).toFixed(6))+","+String(parseFloat(g.options.locations[0].longitude).toFixed(6)),i="&maptype="+google.maps.MapTypeId[g.options.mapType],s="&markers=",p="https://maps.googleapis.com/maps/api/staticmap?sensor=false"+a+n,empty(r)||(p="https://maps.googleapis.com/maps/api/staticmap?key="+r+a+n),1==g.options.locations.length?p+=e+t+i+(s+=String(parseFloat(g.options.locations[0].latitude).toFixed(6))+","+String(parseFloat(g.options.locations[0].longitude).toFixed(6))):(l=new Array,d.each(g.options.locations,function(o,a){l.push(String(parseFloat(a.latitude).toFixed(6))+","+String(parseFloat(a.longitude).toFixed(6)))}),p+=(s+=l.join("|"))+i),g.locationMap().show().html('<img src="'+p+'" />'),g.busy(!1)):(o=d.uid("ext"),window[o]=function(){d.___GoogleMaps.resolve()},d.___GoogleMaps||(d.___GoogleMaps=d.Deferred(),r?EasyBlog.require().script({prefetch:!1},"https://maps.googleapis.com/maps/api/js?key="+r+"&language="+g.options.language+"&callback="+o):EasyBlog.require().script({prefetch:!1},"https://maps.googleapis.com/maps/api/js?language="+g.options.language+"&callback="+o)),d.___GoogleMaps.done(function(){g._init()}))},_init:function(){null===g.options.fitBounds&&(1==g.options.locations.length?g.options.fitBounds=!1:g.options.fitBounds=!0),g.options.disableMapsUI=Boolean(g.options.disableMapsUI),g.locations=new Array,d.each(g.options.locations,function(o,a){"null"!=a.latitude&&"null"!=a.longitude&&g.locations.push(new google.maps.LatLng(a.latitude,a.longitude))}),0<g.locations.length&&g.renderMap(),g.busy(!1)},busy:function(o){g.locationMap().toggleClass("loading",o)},renderMap:function(){var o;g.busy(!0),g.locationMap().show(),o=g.options.center?new google.maps.LatLng(center.latitude,center.longitude):g.locations[0],g.map=new google.maps.Map(g.locationMap()[0],{zoom:parseInt(g.options.zoom),minZoom:parseInt(g.options.minZoom),maxZoom:parseInt(g.options.maxZoom),center:o,mapTypeId:google.maps.MapTypeId[g.options.mapType],disableDefaultUI:g.options.disableMapsUI}),google.maps.event.addListener(g.map,"tilesloaded",function(){0==g.mapLoaded&&(g.mapLoaded=!0,g.loadLocations())})},loadLocations:function(){g.bounds=new google.maps.LatLngBounds,g.infoWindow=new Array,markerClustererMarker=new Array,d.each(g.locations,function(o,a){g.bounds.extend(a),marker=g.addMarker(a,g.options.locations[o]),markerClustererMarker.push(marker)}),g.options.fitBounds&&g.map.fitBounds(g.bounds),g.options.enableClusterer&&(localPath="/media/com_easyblog/images/gmapmarkers/",new MarkerClusterer(g.map,markerClustererMarker,{imagePath:localPath+"m"}))},addMarker:function(o,a){if(o){o=new google.maps.Marker({position:o,map:g.map});return o.setAnimation(google.maps.Animation.DROP),g.addInfoWindow(o,a),o}},addInfoWindow:function(o,a){var n=(n=a.content)||a.address,e=new google.maps.InfoWindow;e.setContent(n),g.infoWindow.push(e),1<g.options.locations.length?google.maps.event.addListener(o,"click",function(){d.each(g.infoWindow,function(o,a){a.close()}),e.open(g.map,o)}):(google.maps.event.addListener(o,"click",function(){e.open(g.map,o)}),e.open(g.map,o)),a.ratingid&&google.maps.event.addListener(e,"domready",function(){d("[data-eb-module-postmap] [data-rating-form]");d("[data-eb-module-postmap] [data-rating-form]").implement(EasyBlog.Controller.Ratings)})}}}),a.resolve()})});