EasyBlog.module("site/search/filters",function(t){var a=this;EasyBlog.require().done(function(n){EasyBlog.Controller("Search.Filters",{defaultOptions:{activeCategoryId:0,"{searchForm}":"[data-eb-search-form]","{searchInput}":"[data-eb-search-input]","{activeTitle}":"[data-category-title]","{catNavItem}":"[data-category-nav]","{catNavBack}":"[data-category-back]","{catFilterItem}":"[data-eb-filter]","{inputCatId}":"[data-category-id]","{activeCatTitle}":"[data-category-title]","{categoryContainer}":"[data-eb-category-container]","{categoryGroup}":"[data-eb-category-group]","{resultBar}":"[data-eb-search-result-bar]","{inputTagIds}":"[data-tag-ids]","{tagContainer}":"[data-eb-tags-container]","{tagClearBtn}":"[data-eb-tags-clear]","{tagFilterItem}":"[data-eb-tags-filter]","{tagCounter}":"[data-eb-tags-count]","{sortItem}":"[data-sort-filter]","{sortTitle}":"[data-sort-title]","{sortInput}":"[data-sort-input]","{sortContainer}":"[data-sort-container]","{orderItem}":"[data-order-filter]","{orderTitle}":"[data-order-title]","{orderInput}":"[data-order-input]","{orderContainer}":"[data-order-container]"}},function(i,r){return{init:function(){i.isLoading=!1,i.updateActiveTags(),i.initSorting()},updateActiveCategory:function(t,a){i.activeCatTitle().html(a),i.inputCatId().val(t)},hideParents:function(t){t.siblings().addClass("t-d--none")},hideSiblingsAndSelf:function(t){t.addClass("t-d--none"),t.siblings().addClass("t-d--none")},loading:function(){i.categoryGroup().addClass("t-d--none"),i.categoryContainer().addClass("is-loading")},doneLoading:function(){i.categoryGroup().removeClass("t-d--none"),i.categoryContainer().removeClass("is-loading")},searchLoading:function(){i.element.addClass("is-loading")},searchDoneLoading:function(){i.wrapper().removeClass("is-loading")},updateActiveTags:function(){var e=[],t=i.tagContainer().find("[data-eb-tags-filter].is-active");n.each(t,function(t,a){e.push(n(a).data("id"))}),i.tagCounter().text(e.length),i.tagCounter().closest("a").removeClass("t-border--primary"),0<e.length&&i.tagCounter().closest("a").addClass("t-border--primary"),i.inputTagIds().val(e.join(","))},initSorting:function(){var t=i.sortInput().val(),a=i.orderInput().val();!t||0<(t=i.sortContainer().find('[data-sort-filter="'+t+'"]')).length&&i.activateSorting(t),a&&i.updateOrdering(a)},activateSorting:function(t){var a=t.closest("li"),e=t.data("sort-filter"),t=t.attr("title");a.addClass("active"),i.sortTitle().text(t),i.sortInput().val(e)},activateOrdering:function(t){var a=t.closest("li"),e=t.data("order-filter"),t=t.attr("title");a.addClass("active"),i.orderTitle().text(t),i.orderInput().val(e)},updateOrdering:function(t){t=i.orderContainer().find('[data-order-filter="'+t+'"]');0<t.length&&(i.orderContainer().find("li").removeClass("active"),i.activateOrdering(t))},hideResultsContent:function(){n("[data-eb-search-content]").addClass("t-hidden")},hideResultBar:function(){i.resultBar().addClass("t-hidden")},submitSearchForm:function(){i.isLoading||(i.isLoading=!0,i.hideResultsContent(),i.hideResultBar(),i.searchLoading(),i.searchForm().submit())},"{orderItem} click":function(t,a){t=n(t);i.orderContainer().find("li").removeClass("active"),i.activateOrdering(t),0<n("[data-eb-search-content]").length&&!i.isLoading&&i.submitSearchForm()},"{sortItem} click":function(t,a){var e=n(t),t=e.data("sort-filter");i.sortContainer().find("li").removeClass("active"),i.activateSorting(e),""==i.orderInput().val()&&i.updateOrdering("asc"),"hits"==t&&i.updateOrdering("desc"),0<n("[data-eb-search-content]").length&&!i.isLoading&&i.submitSearchForm()},"{tagClearBtn} click":function(){var t=0<i.searchInput().val().length,a=0<i.inputTagIds().val().length;t&&a||(event.preventDefault(),event.stopPropagation()),i.tagFilterItem().removeClass("is-active"),i.updateActiveTags(),t&&a&&i.submitSearchForm()},"{tagFilterItem} click":function(t,a){var e=0<i.searchInput().val().length;e||(a.preventDefault(),a.stopPropagation());t=n(t);t.hasClass("is-active")?t.removeClass("is-active"):t.addClass("is-active"),i.updateActiveTags(),e&&i.submitSearchForm()},"{catNavBack} click":function(t,a){a.preventDefault(),a.stopPropagation();var e=n(t).parent("ul");e.addClass("t-d--none");a=e.parent("[data-category-filter]"),t=a.data("category-filter");r.activeCategoryId&&t==r.activeCategoryId&&a.addClass("active"),a.parent().removeClass("has-submenu"),e.siblings().removeClass("t-d--none"),a.removeClass("t-d--none"),a.siblings().removeClass("t-d--none")},"{catFilterItem} click":function(t,a){var e=n(t),r=e.data("id"),t=n.trim(e.text());i.updateActiveCategory(r,t),n("[data-category-filter]").removeClass("active"),e.parent("[data-category-filter]").addClass("active"),0<i.searchInput().val().length&&i.submitSearchForm()},"{catNavItem} click":function(t,a){a.preventDefault(),a.stopPropagation();var e=n(t),r=e.parent("[data-category-filter]"),a=r.data("category-filter");e.parents("[data-eb-category-container]").find("[data-eb-category-group]").addClass("has-submenu"),r.removeClass("active"),i.hideParents(r),i.hideSiblingsAndSelf(e);t=r.parent("[data-category-nested]");0<t.length&&t.addClass("has-submenu");t=e.siblings("[data-category-nested]");if(0<t.length)return i.hideParents(e),i.hideSiblingsAndSelf(e),void t.removeClass("t-d--none");i.loading(),EasyBlog.ajax("site/views/categories/getCategoriesForFilters",{parentId:a,activeId:i.inputCatId().val()}).done(function(t){i.hideParents(e),i.hideSiblingsAndSelf(e),r.append(t)}).always(function(){i.doneLoading()})}}}),a.resolve()})});