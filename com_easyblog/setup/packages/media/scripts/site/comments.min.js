EasyBlog.module("site/comments",function(e){var t=this;EasyBlog.require().script("site/vendors/markitup").done(function(o){EasyBlog.Controller("Comments",{defaultOptions:{"{item}":"[data-comment-item]"}},function(e,t){return{init:function(){e.commentForm=e.addPlugin("form"),e.commentList=e.addPlugin("list")}}}),EasyBlog.Controller("Comments.Form",{defaultOptions:{"{formWrapper}":"[data-comment-form-wrapper]","{form}":"[data-comment-form]","{title}":"[data-comment-title]","{name}":"[data-comment-name]","{email}":"[data-comment-email]","{website}":"[data-comment-website]","{counter}":"[data-comment-counter]","{subscribe}":"[data-comment-subscribe]","{terms}":"[data-comment-terms]","{tncLink}":"[data-comment-tnc]","{parentId}":"[data-comment-parent-id]","{commentDepth}":"[data-comment-depth]","{blogId}":"[data-comment-blog-id]","{depth}":"[data-comment-depth]","{notice}":"[data-comment-notice]","{editor}":"[data-comment-editor]","{submit}":"[data-comment-submit]","{formToken}":"[data-comment-token]","{recaptcha}":"[data-recaptcha-item]","{captcha}":"[data-comment-captcha]"}},function(n,e,t){return{init:function(){n.initEditor(),n.list=n.addPlugin("list");var e=n.recaptcha.inside(n.element).length,t=n.captcha.inside(n.element).length;e<1&&0<t&&(n.captcha=n.addPlugin("captcha"))},initEditor:function(){1==n.editor().data("comment-bbcode")&&n.editor().markItUp(window.EasyBlogBBCodeSettings)},setNotice:function(e,t){t="info"==t?"o-alert--info":"success"==t?"o-alert--success":"error"==t?"o-alert--danger":"";n.notice().removeClass("hide").addClass("o-alert "+t).html(e)},resetForm:function(){0!=n.parentId().val()&&n.form().appendTo(n.formWrapper()),n.subscribe().attr("checked",!1),n.editor().val(""),n.website().val(""),n.name().val(""),n.depth().val(0),n.parentId().val(0),n.trigger("resetForm")},resetNotice:function(){n.notice().addClass("hide").removeClass("o-alert--info o-alert--danger").html("")},"{self} replyComment":function(e,t,a,i,o){n.notice().addClass("hide"),a.after(n.form()),n.depth().val(o),n.parentId().val(i)},"{self} cancelReply":function(e,t,a,i){n.parentId().val(0),n.depth().val(0),n.formWrapper().html(n.form())},"{self} commentAdded":function(){var e=n.counter().html(),e=parseInt(e)+1;n.counter().html(e.toString()),n.resetForm()},getValues:function(){var e={title:n.title().val(),name:n.name().val(),email:n.email().val(),website:n.website().val(),subscribe:n.subscribe().is(":checked")?1:0,comment:n.editor().val(),terms:n.terms().is(":checked")?1:0,depth:n.depth().val(),parentId:n.parentId().val(),blogId:n.blogId().val()};return n.trigger("submitComment",[e]),e},"{tncLink} click":function(){EasyBlog.dialog({content:EasyBlog.ajax("site/views/comments/terms")})},saveState:o.Deferred(),"{self} reloadCaptcha":function(){n.saveState=o.Deferred()},saveComment:function(e){n.saveState.done(function(){e=o(e),n.resetNotice(),e.addClass("is-loading"),e.attr("disabled",!0);var i=n.getValues();EasyBlog.ajax("site/views/comments/save",i).done(function(e,t,a){n.setNotice(t,a),n.trigger("commentAdded",[e,i])}).fail(function(e){n.setNotice(e,"error")}).always(function(){e.removeAttr("disabled"),e.removeClass("is-loading"),n.trigger("reloadCaptcha")})}).fail(function(){})},"{submit} click":function(e,t){t.preventDefault();t=[];o("[data-eb-comments]").trigger("onSaveComment",[t]),t.length<=0?n.saveState.resolve():o.when.apply(null,t).done(function(){n.saveState.resolve()}).fail(function(){n.saveState.reject()}),n.saveComment(e)}}}),EasyBlog.Controller("Comments.Form.Captcha",{defaultOptions:{"{input}":"[data-captcha-input]","{reload}":"[data-captcha-reload]","{captchaId}":"[data-captcha-id]","{image}":"[data-captcha-image]"}},function(i,e,t){return{"{self} submitComment":function(e,t,a){a["captcha-response"]=i.input().val(),a["captcha-id"]=i.captchaId().val()},"{self} resetForm":function(){i.input().val(""),i.reload().click()},"{self} reloadCaptcha":function(){EasyBlog.ajax("site/views/comments/reloadCaptcha",{previousId:i.captchaId().val()}).done(function(e,t){i.image().attr("src",e),i.captchaId().val(t)})},"{reload} click":function(){i.trigger("reloadCaptcha")}}}),EasyBlog.Controller("Comments.List",{defaultOptions:{"{item}":"[data-comment-item]","{list}":"[data-comment-list]","{edit}":"[data-comment-edit]","{editor}":"[data-comment-edit-editor]","{body}":"[data-comment-body]","{cancelEdit}":"[data-comment-edit-cancel]","{cancelReply}":"[data-comment-reply-cancel]","{update}":"[data-comment-edit-update]","{preview}":"[data-comment-preview]","{reply}":"[data-comment-reply]","{like}":"[data-comment-like]","{unlike}":"[data-comment-unlike]","{notice}":"[data-edit-comment-notice]","{viewReplies}":"[data-comment-view-replies]","{deleteButton}":"[data-comment-delete]","{likeCounter}":"[data-comment-like-counter]","{likeTooltip}":"[data-comment-like-tooltip]","{rawContent}":"[data-comment-edit-raw]","{empty}":"[data-comment-empty]"}},function(n,e,t){return{updatePreview:function(e){n.preview().html(e)},"{self} cancelEdit":function(e,t,a,i,o){n.options.editing=!1,a.find(n.editor.selector).addClass("hide"),a.find(n.body.selector).removeClass("hide"),a.find(n.editor.selector).find("textarea").val(a.find(n.rawContent.selector).html())},"{self} updateComment":function(e,t,a,i,o){n.options.editing=!1,a.find(n.rawContent.selector).html(o),a.find(n.editor.selector+" textarea").val(o),a.find(n.preview.selector).html(i),a.find(n.editor.selector).addClass("hide"),a.find(n.body.selector).removeClass("hide")},"{self} commentAdded":function(e,t,a,i){if(n.list().removeClass("is-empty"),0!=i.parentId){i=n.item.selector+'[data-id="'+i.parentId+'"]';return o(i).find(n.cancelReply.selector).click(),void o(i).after(a)}n.list().append(a)},"{edit} click":function(e){var t=n.item.of(e),e=(t.data("id"),t.find(n.editor.selector)),t=t.find(n.body.selector);if(n.options.editing)return n.options.editing=!1,e.addClass("hide"),void t.removeClass("hide");n.options.editing=!0,t.addClass("hide"),e.removeClass("hide"),bbcodeEnabled=e.find("textarea").data("comment-bbcode"),bbcodeEnabled&&!e.find("textarea").hasClass("markItUpEditor")&&e.find("textarea").show().markItUp(window.EasyBlogBBCodeSettings)},"{update} click":function(e){var a=n.item.of(e),t=a.data("id"),i=a.find(n.editor.selector).find("textarea").val(),e=a.find(n.editor.selector).find("[data-comment-title-edit]").val();EasyBlog.ajax("site/views/comments/update",{id:t,message:i,title:e}).done(function(e,t){a.find(n.preview.selector).html(e),n.trigger("updateComment",[a,e,t])}).fail(function(e){n.setNotice(e,"error")})},setNotice:function(e,t){t="info"==t?"o-alert--info":"success"==t?"o-alert--success":"error"==t?"o-alert--danger":"";n.notice().removeClass("hide").addClass("o-alert "+t).html(e)},"{cancelReply} click":function(e){var t=n.item.of(e),a=t.data("id");o(e).addClass("hide"),t.find(n.reply.selector).removeClass("hide"),n.trigger("cancelReply",[t,a])},"{cancelEdit} click":function(e){e=n.item.of(e),e.data("id");n.trigger("cancelEdit",[e])},"{reply} click":function(e){var t=n.item.of(e),a=t.data("id"),i=e.data("depth");n.trigger("replyComment",[t,a,i]),o(e).addClass("hide"),t.find(n.cancelReply.selector).removeClass("hide")},"{deleteButton} click":function(e){e=n.item.of(e).data("id");EasyBlog.dialog({content:EasyBlog.ajax("site/views/comments/confirmDelete",{id:e})})},"{like} click":function(e){var a=n.item.of(e),e=a.data("id");EasyBlog.ajax("site/views/comments/like",{id:e}).done(function(e,t){a.addClass("is-like"),a.find(n.likeCounter.selector).html(t)})},"{viewReplies} click":function(t){var a=n.item.of(t),e=a.data("id");EasyBlog.ajax("site/views/comments/loadReplies",{id:e}).done(function(e){o(e).insertAfter(a),t.remove()})},"{unlike} click":function(e){var a=n.item.of(e),e=a.data("id");EasyBlog.ajax("site/views/comments/unlike",{id:e}).done(function(e,t){a.removeClass("is-like"),a.find(n.likeCounter.selector).html(t)})}}}),t.resolve()})});