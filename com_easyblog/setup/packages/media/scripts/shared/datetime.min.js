EasyBlog.module("shared/datetime",function(e){var t=this;EasyBlog.require().library("datetimepicker","moment").done(function(l){EasyBlog.Controller("Post.Datetime",{defaultOptions:{format:"Do MMM, YYYY HH:mm",language:"en",originalValue:"",pickTime:!0,"{calendar}":"[data-calendar]","{cancel}":"[data-cancel]","{datetime}":"[data-datetime]","{input}":"[data-input]","{remove}":"[data-remove]","{error}":"[data-field-error]"}},function(n,o,e){return{init:function(){var e;n.calendar()._datetimepicker({component:"eb",format:o.format,language:o.language,minDate:o.minDate,pickTime:o.pickTime}),n.datetimepicker=n.calendar().data("DateTimePicker"),o.originalValue=n.datetime().val(),n.previousValue=l.moment(o.originalValue).format("DD/MM/YYYY HH:mm"),l.isEmpty(o.originalValue)||(n.datetimepicker.setDate(l.moment(o.originalValue)),e=n.datetime().attr("name"),"0000-00-00 00:00:00"===o.originalValue||"publish_down"!==e&&"autopost_date"!==e||n.remove().removeClass("t-hidden"))},"{calendar} onPopulate":function(e,t,a){n.hideError();var r="",i=l.moment(o.currentDate);(r=a?(i=l.moment(a)).format("DD/MM/YYYY HH:mm"):r)||(n.triggerDateTimeAfterChanged=!1),n.datetimepicker.setDate(i),n.input().val(r),n.triggerDateTimeAfterChanged=!0},triggerDateTimeAfterChanged:!0,"{calendar} dp.change":function(e,t){t.date.lang("en");var a=t.date.format("YYYY-MM-DD HH:mm:ss");n.datetime().val(a),n.input().val(t.date.format("DD/MM/YYYY HH:mm")),t.date.lang(o.language);t.date.format("YYYY-MM-DD HH:mm:ss");n.toggleCancelButton(),n.triggerDateTimeAfterChanged&&e.trigger("dateTimeAfterChanged",[n])},"{cancel} click":function(){l.isEmpty(o.originalValue)||"0000-00-00 00:00:00"==o.originalValue?(n.datetime().val(""),n.input().val("")):n.datetimepicker.setDate(l.moment(o.originalValue)),n.toggleCancelButton()},toggleCancelButton:function(){n.cancel().toggleClass("t-hidden",n.datetime().val()==o.originalValue)},showError:function(e){n.error().closest(".o-form-group").addClass("has-error"),n.error().html(e),n.error().removeClass("t-hidden")},hideError:function(){n.error().closest(".o-form-group").removeClass("has-error"),n.error().addClass("t-hidden")},"{input} keyup":function(e,t){var a=8==t.keyCode||46==t.keyCode,t=e.val(),e=t.length;if(a&&0==e&&(n.hideError(),n.datetimepicker.setDate(l.moment(o.originalValue))),16==e){if(!n.validate(t))return void n.showError(o.errorMessage);if(t==n.previousValue)return;t=n.formatValue(t),n.datetimepicker.setDate(l.moment(t))}n.previousValue=t},"{input} blur":function(e,t){var a=e.val(),e=a.length;if(a){if(n.validate(a))return 10==e||11==e?(a=a.trim(),a=n.formatValue(a+=" 00:00"),void n.datetimepicker.setDate(l.moment(a))):void(0<e&&e<16&&n.showError(o.incompleteMessage));n.showError(o.errorMessage)}},validate:function(e){n.hideError();var a=!0;e.length;return e.split("").every(function(e,t){if(2!==t&&5!==t&&10!==t&&13!==t){e=parseInt(e);if(!Number.isInteger(e))return a=!1}return(2!=t&&5!=t||"/"===e)&&(10!=t||" "===e)&&(13!=t||":"===e)||(a=!1)}),a},"{remove} click":function(){l.isEmpty(o.originalValue)||(n.datetime().val(""),n.input().val("")),n.remove().addClass("t-hidden")},formatValue:function(e){return e.substr(6,4)+"-"+e.substr(3,2)+"-"+e.substr(0,2)+" "+e.substr(11,2)+":"+e.substr(14,2)+":00"}}}),t.resolve()})});