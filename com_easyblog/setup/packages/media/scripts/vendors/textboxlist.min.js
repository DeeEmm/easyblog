FD50.module("textboxlist",function(m){var e=this;m.require().script("autosize.input","scrollTo","ui/position").done(function(){function t(){var n=8,o=40,l=13,a=27,s=38;m.template("textboxlist/item",'<div class="textboxlist-item[%== (this.locked) ? " is-locked" : "" %]" data-textboxlist-item><span class="textboxlist-itemContent" data-textboxlist-itemContent>[%== html %]</span><div class="textboxlist-itemRemoveButton" data-textboxlist-itemRemoveButton><i class="fdi fa fa-times"></i></a></div>'),m.template("textboxlist/itemContent",'[%= title %]<input type="hidden" name="[%= name %]" value="[%= id %]"/>'),m.Controller("Textboxlist",{pluginName:"textboxlist",hostname:"textboxlist",defaultOptions:{view:{item:"textboxlist/item",itemContent:"textboxlist/itemContent"},plugin:{},name:"items[]",unique:!0,caseSensitive:!1,max:null,ignoreLocked:!1,filterItem:null,"{item}":"[data-textboxlist-item]","{itemContent}":"[data-textboxlist-itemContent]","{itemRemoveButton}":"[data-textboxlist-itemRemoveButton]","{textField}":"[data-textboxlist-textField]"}},function(a){return{init:function(){var t=a.textField();t.autosizeInput(),t.data("placeholderText",t.attr("placeholder"));t=t.data("textboxlistName");t&&(a.options.name=t),a.item().each(function(){var t,e=m(this),i=e.find(a.itemContent.selector);a.createItem({id:e.data("id")||(t=m.uid("item-"),e.data("id",t),t),title:e.data("title")||m.trim(i.text()),locked:e.hasClass("is-locked"),html:i.html()})}),(a.options.plugin.autocomplete||a.element.data("query"))&&a.addPlugin("autocomplete"),a.on("keypress",a.textField(),function(t){if(t.keyCode==l)return t.preventDefault()})},setLayout:function(){var t=a.textField(),e=t.data("placeholderText");0<a.item().length&&(e=""),t.attr("placeholder",e).data("autosizeInputInstance").update()},enable:function(){a.element.removeClass("disabled"),a.textField().enabled(!0)},disable:function(){a.element.addClass("disabled"),a.textField().disabled(!0)},items:{},itemsByTitle:{},get:function(t){t=a.getItemKey(t);if(a.itemsByTitle.hasOwnProperty(t))return a.itemsByTitle[t]},getItemKey:function(t){return a.options.caseSensitive?t:t.toLowerCase()},filterItem:function(t){var e=a.options.filterItem;m.isFunction(e)&&(t=e.call(a,t));var i,o=a.itemsByTitle;return m.isString(t)&&""!==t&&(i=t,e=a.getItemKey(i),t=o.hasOwnProperty(e)?a.itemsByTitle[e]:{id:m.uid("item-"),title:i,key:a.getItemKey(i),locked:!1}),t.name=t.name||a.options.name,t.html=t.html||a.view.itemContent(!0,t),t},createItem:function(t){t.key=a.getItemKey(t.title),a.items[t.id]=t,a.itemsByTitle[t.key]=t},deleteItem:function(t){var e=a.items[t];a.item().filterBy("id",t).remove(),delete a.items[t];e=a.options.caseSensitive?e.title:e.title.toLowerCase();delete a.itemsByTitle[e]},addItem:function(t,e){if(t){var i=a.options,o=i.max;if((e||null===o||!((i.ignoreLocked?a.item(":not(.is-locked)"):a.item()).length>=o))&&(t=a.filterItem(t),m.isPlainObject(t))){var o=a.item().filterBy("id",t.id),n=(n=i.unique&&0<o.length?o:n)||a.view.item(t).addClass(t.className||"").attr("data-id",t.id);return a.createItem(t),t.locked?0<(o=a.item(".is-locked:last")).length?n.insertAfter(o):n.prependTo(a.element):n.insertBefore(a.textField()),a.trigger("addItem",[t]),a.trigger("listChange"),t}}},removeItem:function(t){var e=a.items[t];a.deleteItem(t),a.trigger("removeItem",[e]),a.trigger("listChange")},clearItems:function(){a.item().each(function(){a.removeItem(m(this).data("id"))})},getAddedItems:function(){var e=[];return a.item().each(function(){var t=m(this).data("id");e.push(a.items[t])}),e},"{self} addItem":function(){a.setLayout()},"{self} removeItem":function(){a.setLayout()},"{itemRemoveButton} click":function(t){t=t.parents(a.item.selector);a.removeItem(t.data("id"))},"{textField} keydown":function(t,e){e=e.keyCode;t.data("realEnterKey",e==l)},"{textField} keypress":function(t,e){var i=t.data("realEnterKey"),o=e.keyCode==l;t.data("realEnterKey",i&&o);o=m.trim(a.textField().val());if(e.keyCode===l)if(t.data("realEnterKey")){e=(e=a.trigger("useItem",[o])).item;if(!1===(e=void 0===e?o:e)||null===e)return;m.isPlainObject(e)?a.addItem(e):(e=e.split(","),m.each(e,function(t,e){a.addItem(e)})),t.val("")}},"{textField} keyup":function(t,e){var i=m.trim(a.textField().val()),o="canRemoveItemUsingBackspace";e.keyCode===n?""===i&&(a[o]?0<(t=t.prev(a.item.selector)).length&&(t=t.data("id"),(i=a.items[t]).locked||a.removeItem(t)):a[o]=!0):a[o]=!1},"{self} click":function(t,e){var i=a.textField();i.is(e.target)||i.focus()},"{textField} focusin":function(){a.activated||(a.activated=!0,a.trigger("textboxlistActivate"))},"{self} mousedown":function(){a.focusing=!0},"{self} mouseup":function(){a.focusing=!1},"{self} focusout":function(){a.focusing||(a.activated=!1,a.deactivateTimer=setTimeout(function(){a.activated||a.trigger("textboxlistDeactivate")},1))}}}),m(document).on("click.textboxlist.data-api","[data-textboxlist]",function(t){m(this).addController(m.Controller.Textboxlist).textField().focus()}).on("focus.textboxlist.data-api","[data-textboxlist] [data-textboxlist-textField]",function(t){m(this).parents("[data-textboxlist]").addController(m.Controller.Textboxlist)}),m.template("textboxlist/menu",'<div id="eb" class="eb-textboxlist textboxlist-autocomplete" data-textboxlist-autocomplete><b><b></b></b><div class="textboxlist-autocomplete-inner" data-textboxlist-autocomplete-viewport><div class="textboxlist-autocomplete-loading" data-textboxlist-autocomplete-loading></div><div class="textboxlist-autocomplete-empty" data-textboxlist-autocomplete-empty></div><ul class="textboxlist-menu" data-textboxlist-menu></ul></div></div>'),m.template("textboxlist/menuItem",'<li class="textboxlist-menuItem" data-textboxlist-menuItem>[%== html %]</li>'),m.template("textboxlist/loadingHint",'<i class="textboxlist-autocomplete-loading-indicator"></i>'),m.template("textboxlist/emptyHint",'<span class="textboxlist-autocomplete-empty-text">No items found.</span>'),m.Controller("Textboxlist.Autocomplete",{defaultOptions:{view:{menu:"textboxlist/menu",menuItem:"textboxlist/menuItem",loadingHint:"textboxlist/loadingHint",emptyHint:"textboxlist/emptyHint"},cache:!0,minLength:1,limit:10,highlight:!0,caseSensitive:!1,exclusive:!1,query:null,position:{my:"left top",at:"left bottom",collision:"none"},filterItem:null,showEmptyHint:!1,showLoadingHint:!1,id:"eb",component:"",modifier:"",shadow:!1,sticky:!1,animation:!1,"{menu}":"[data-textboxlist-menu]","{menuItem}":"[data-textboxlist-menuItem]","{viewport}":"[data-textboxlist-autocomplete-viewport]","{loadingHint}":"[data-textboxlist-autocomplete-loading]","{emptyHint}":"[data-textboxlist-autocomplete-empty]"}},function(d,e,t){return{init:function(){if(!d.element.data(d.Class.fullName))return d.destroy(),void d.view.menu().attr("id",e.id).addClass(e.component).addClass(e.modifier).addClass(e.shadow?"has-shadow":"").addClass(e.animation?"has-animation":"").addClass(e.sticky?"is-sticky":"").addClass(d.textboxlist.options.component).appendTo("body").data(d.Class.fullName,!0).addController(d.Class,d.options);var t=d.textboxlist;t.autocomplete=d,(t.pluginInstances.autocomplete=d).options.position.of=d.textboxlist.element,d.initQuery(),d.view.loadingHint().appendTo(d.loadingHint()),d.view.emptyHint().appendTo(d.emptyHint()),d.element.detach()},initQuery:function(){var e,i,o,t=d.options.query||d.textboxlist.element.data("query");m.isUrl(t)?(e=t,d.query=function(t){return m.ajax(e+t)}):m.isFunction(t)?(i=t,d.query=function(t){return i.call(d,t)}):m.isArray(t)&&(o=t,d.query=function(e){var i=m.Deferred(),e=e.toLowerCase();return setTimeout(function(){var t=m.grep(o,function(t){return-1<t.title.toLowerCase().indexOf(e)});i.resolve(t)},0),i})},setLayout:function(){d.hidden||d.element.css({opacity:1,width:d.textboxlist.element.outerWidth()}).position(d.options.position)},"{window} resize":m.debounce(function(){d.element.css("opacity",0),d.setLayout()},250),"{window} scroll":m.debounce(function(){d.element.css("opacity",0),d.setLayout()},250),"{window} dialogTransitionStart":function(){d.hidden=!0,d.element.css("opacity",0)},"{window} dialogTransitionEnd":function(){d.hidden=!1,d.setLayout()},show:function(){clearTimeout(d.sleep),d.element.appendTo("body").show(),d.hidden=!1,d.setLayout()},hide:function(){d.element.hide();var t=d.menuItem(),e=t.filter(".active");0<e.length&&(d.lastItem={keyword:m.trim(d.textboxlist.textField().val()),item:e.data("item")}),t.removeClass("active"),d.render.reset(),d.hidden=!0,clearTimeout(d.sleep),d.sleep=setTimeout(function(){d.element.detach()},3e3)},queries:{},populated:!1,populate:function(e){d.populated=!1;var t=d.element,i=d.options;t.removeClass("loading empty"),i.showLoadingHint&&d.hide();var o=d.trigger("populateKeyword",[e]);o.keyword&&(e=o.keyword);var n=i.caseSensitive?e:e.toLowerCase(),a=d.queries[n],l=!m.isDeferred(a)||!d.options.cache,o=function(){i.showLoadingHint&&(t.addClass("loading"),d.show()),(a=l||!l&&"rejected"==a.state()?d.queries[n]=d.query(e):a).done(d.render(function(t){return[t,e]})).fail(function(){d.hide()}).always(function(){t.removeClass("loading")}),d.trigger("queryKeyword",[a,e])};l?(clearTimeout(d.queryTask),d.queryTask=setTimeout(o,250)):o()},populateTask:null,populateFromTextField:function(){clearTimeout(d.populateTask),d.populateTask=setTimeout(function(){var t=d.textboxlist.textField(),t=m.trim(t.val());""===t||t.length<d.options.minLength?d.hide():d.populate(t)},1)},render:m.Enqueue(function(t,o){m.isArray(t)||(t=[]);var n=d.textboxlist,a=d,e=d.element,l=d.options,s=d.menu();if(t.length<1)l.showEmptyHint?(s.empty(),e.addClass("empty"),n.trigger("renderMenu",[s,a,n]),d.show()):d.hide();else{e.removeClass("empty"),l.cache&&s.data("keyword")===o||(s.empty(),m.each(t,function(t,e){m.isPlainObject(e)||(e={html:e}),n.trigger("filterItem",[e,a,n]);var i=l.filterItem;m.isFunction(i)&&(e=i.call(d,e,o)),m.isPlainObject(e)&&!e.discard&&(i=e.menuHtml||e.title,d.view.menuItem({html:i}).addClass(e.className||"").data("item",e).appendTo(s))}),s.data("keyword",o));t=d.menuItem();if(n.trigger("filterMenu",[s,t,a,n]),t.filter(":not(.hidden)").length<1&&(e.addClass("empty"),!l.showEmptyHint))return d.hide();l.exclusive&&d.menuItem(":not(.hidden):first").addClass("active"),n.trigger("renderMenu",[s,a,n]),d.show()}}),"{textboxlist.textField} keydown":function(t,e){clearTimeout(d.sleep);var i=d.menuItem(".active:not(.hidden)");i.length<1&&(i=!1);d.textboxlist.textField();switch(e.keyCode){case s:d.menuItem().removeClass("active"),(i?i.prev(d.menuItem.selector+":not(.hidden)"):d.menuItem(":not(.hidden):last")).addClass("active"),e.preventDefault();break;case o:d.menuItem().removeClass("active"),(i?i.next(d.menuItem.selector+":not(.hidden)"):d.menuItem(":not(.hidden):first")).addClass("active"),e.preventDefault();break;case a:d.hide();break;case l:break;default:d.populateFromTextField()}(i=d.menuItem(".active:not(.hidden)")).length<1||d.viewport().scrollIntoView(i)},"{textboxlist} textboxlistActivate":function(t){d.populateFromTextField()},"{textboxlist} textboxlistDeactivate":function(t){setTimeout(function(){d.hide()},150)},"{textboxlist} destroyed":function(){d.element.remove()},"{textboxlist} useItem":function(t,e,i){var o,n=d.options.exclusive;n&&(e.item=!1),d.hidden?(o=d.lastItem,n&&o&&o.keyword==i&&(e.item=o.item)):(0<(o=d.menuItem(".active")).length&&(o=o.data("item"),e.item=o),d.hide())},"{menuItem} mousedown":function(){d.textboxlist.focusing=!0},"{menuItem} mouseup":function(){d.textboxlist.focusing=!1},"{menuItem} click":function(t){d.hide();t=t.data("item");d.textboxlist.addItem(t);var e=d.textboxlist.textField().val("");setTimeout(function(){e.focus()},150)},"{menuItem} mouseover":function(t){d.menuItem().removeClass("active"),t.addClass("active")},"{menuItem} mouseout":function(t){d.menuItem().removeClass("active")}}})}t(),e.resolveWith(t)})});