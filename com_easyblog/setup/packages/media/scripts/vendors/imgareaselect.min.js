FD50.module("imgareaselect",function(e){var t=e,e=function(){function ye(){return ge("<div/>")}var ge,we,xe,ve;ge=t,we=Math.abs,xe=Math.max,ve=Math.min,ge.imgAreaSelect=function(o,n){function t(e){return e+le.left-ue.left}function i(e){return e+le.top-ue.top}function r(e){return e-le.left+ue.left}function d(e){return e-le.top+ue.top}function s(e){return e.pageX-ue.left}function a(e){return e.pageY-ue.top}function c(e){var t=e||D,e=e||R;return{x1:me.x1*t,y1:me.y1*e,x2:me.x2*t,y2:me.y2*e,width:me.x2*t-me.x1*t,height:me.y2*e-me.y1*e}}function l(e,t,o,i,s){var n=s||D,s=s||R;(me={x1:e/n||0,y1:t/s||0,x2:o/n||0,y2:i/s||0}).width=me.x2-me.x1,me.height=me.y2-me.y1}function u(){se.width()&&(le={left:se.offset().left,top:se.offset().top},M=se.innerWidth(),O=se.innerHeight(),le.top+=se.outerHeight()-O>>1,le.left+=se.outerWidth()-M>>1,j=n.minWidth/D||0,q=n.minHeight/R||0,B=ve(n.maxWidth/D||1<<24,M),F=ve(n.maxHeight/R||1<<24,O),"1.3.2"!=ge().jquery||"fixed"!=fe||be.getBoundingClientRect||(le.top+=xe(document.body.scrollTop,be.scrollTop),le.left+=xe(document.body.scrollLeft,be.scrollLeft)),ue=/absolute|relative/.test(E.css("position"))?{left:E.offset().left-E.scrollLeft(),top:E.offset().top-E.scrollTop()}:"fixed"==fe?{left:ge(document).scrollLeft(),top:ge(document).scrollTop()}:{left:0,top:0},N=t(0),H=i(0),(me.x2>M||me.y2>O)&&w())}function h(e){if(Y){switch(ne.css({left:t(me.x1),top:i(me.y1)}).add(re).width(te=me.width).height(oe=me.height),re.add(de).add(ce).css({left:0,top:0}),de.width(xe(te-de.outerWidth()+de.innerWidth(),0)).height(xe(oe-de.outerHeight()+de.innerHeight(),0)),ge(ae[0]).css({left:N,top:H,width:me.x1,height:O}),ge(ae[1]).css({left:N+me.x1,top:H,width:te,height:me.y1}),ge(ae[2]).css({left:N+me.x2,top:H,width:M-me.x2,height:O}),ge(ae[3]).css({left:N+me.x1,top:H+me.y2,width:te,height:O-me.y2}),te-=ce.outerWidth(),oe-=ce.outerHeight(),ce.length){case 8:ge(ce[4]).css({left:te>>1}),ge(ce[5]).css({left:te,top:oe>>1}),ge(ce[6]).css({left:te>>1,top:oe}),ge(ce[7]).css({top:oe>>1});case 4:ce.slice(1,3).css({left:te}),ce.slice(2,4).css({top:oe})}!1!==e&&(ge.imgAreaSelect.keyPress!=pe&&ge(document).unbind(ge.imgAreaSelect.keyPress,ge.imgAreaSelect.onKeyPress),n.keys&&ge(document)[ge.imgAreaSelect.keyPress](ge.imgAreaSelect.onKeyPress=pe)),ge.browser.msie&&de.outerWidth()-de.innerWidth()==2&&(de.css("margin",0),setTimeout(function(){de.css("margin","auto")},0))}}function f(e){u(),h(e),G=t(me.x1),J=i(me.y1),Q=t(me.x2),U=i(me.y2)}function m(e,t){n.fadeSpeed?e.fadeOut(n.fadeSpeed,t):e.hide()}function b(e){var t=r(s(e))-me.x1,e=d(a(e))-me.y1;ie||(u(),ie=!0,ne.one("mouseout",function(){ie=!1})),$="",n.resizable&&(e<=n.resizeMargin?$="n":e>=me.height-n.resizeMargin&&($="s"),t<=n.resizeMargin?$+="w":t>=me.width-n.resizeMargin&&($+="e")),ne.css("cursor",$?$+"-resize":n.movable?"move":""),K&&K.toggle()}function p(e){ge("body").css("cursor",""),!n.autoHide&&me.width*me.height!=0||m(ne.add(ae),function(){ge(this).hide()}),ge(document).unbind("mousemove",x),ne.mousemove(b),n.onSelectEnd(o,c())}function y(e){return 1!=e.which||(u(),$?(ge("body").css("cursor",$+"-resize"),G=t(me[/w/.test($)?"x2":"x1"]),J=i(me[/n/.test($)?"y2":"y1"]),ge(document).mousemove(x).one("mouseup",p),ne.unbind("mousemove",b)):n.movable?(T=N+me.x1-s(e),L=H+me.y1-a(e),ne.unbind("mousemove",b),ge(document).mousemove(S).one("mouseup",function(){n.onSelectEnd(o,c()),ge(document).unbind("mousemove",S),ne.mousemove(b)})):se.mousedown(e)),!1}function g(e){X&&(e?(Q=xe(N,ve(N+M,G+we(U-J)*X*(G<Q||-1))),U=xe(H,ve(H+O,J+we(Q-G)/X*(J<U||-1)))):(U=xe(H,ve(H+O,J+we(Q-G)/X*(J<U||-1))),Q=xe(N,ve(N+M,G+we(U-J)*X*(G<Q||-1)))))}function w(){G=ve(G,N+M),J=ve(J,H+O),we(Q-G)<j&&((Q=G-j*(Q<G||-1))<N?G=N+j:N+M<Q&&(G=N+M-j)),we(U-J)<q&&((U=J-q*(U<J||-1))<H?J=H+q:H+O<U&&(J=H+O-q)),Q=xe(N,ve(Q,N+M)),U=xe(H,ve(U,H+O)),g(we(Q-G)<we(U-J)*X),we(Q-G)>B&&(Q=G-B*(Q<G||-1),g()),we(U-J)>F&&(U=J-F*(U<J||-1),g(!0)),me={x1:r(ve(G,Q)),x2:r(xe(G,Q)),y1:d(ve(J,U)),y2:d(xe(J,U)),width:we(Q-G),height:we(U-J)},h(),n.onSelectChange(o,c())}function x(e){return Q=/w|e|^$/.test($)||X?s(e):t(me.x2),U=/n|s|^$/.test($)||X?a(e):i(me.y2),w(),!1}function v(e,t){Q=(G=e)+me.width,U=(J=t)+me.height,ge.extend(me,{x1:r(G),y1:d(J),x2:r(Q),y2:d(U)}),h(),n.onSelectChange(o,c())}function S(e){return G=xe(N,ve(T+s(e),N+M-me.width)),J=xe(H,ve(L+a(e),H+O-me.height)),v(G,J),e.preventDefault(),!1}function z(){ge(document).unbind("mousemove",z),u(),Q=G,U=J,w(),$="",ae.is(":visible")||ne.add(ae).hide().fadeIn(n.fadeSpeed||0),Y=!0,ge(document).unbind("mouseup",k).mousemove(x).one("mouseup",p),ne.unbind("mousemove",b),n.onSelectStart(o,c())}function k(){ge(document).unbind("mousemove",z).unbind("mouseup",k),m(ne.add(ae)),l(r(G),d(J),r(G),d(J)),this instanceof ge.imgAreaSelect||(n.onSelectChange(o,c()),n.onSelectEnd(o,c()))}function C(e){return 1!=e.which||ae.is(":animated")||(u(),T=G=s(e),L=J=a(e),ge(document).mousemove(z).mouseup(k)),!1}function A(){f(!1)}function e(){P=!0,I(n=ge.extend({classPrefix:"imgareaselect",movable:!0,parent:"body",resizable:!0,resizeMargin:10,onInit:function(){},onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}},n)),ne.add(ae).css({visibility:""}),n.show&&(Y=!0,u(),h(),ne.add(ae).hide().fadeIn(n.fadeSpeed||0)),setTimeout(function(){n.onInit(o,c())},0)}function W(e,t){for(var o in t)void 0!==n[o]&&e.css(t[o],n[o])}function I(e){if(e.parent&&(E=ge(e.parent)).append(ne.add(ae)),ge.extend(n,e),u(),null!=e.handles){for(ce.remove(),ce=ge([]),_=e.handles?"corners"==e.handles?4:8:0;_--;)ce=ce.add(ye());ce.addClass(n.classPrefix+"-handle").css({position:"absolute",fontSize:0,zIndex:he+1||1}),0<=!parseInt(ce.css("width"))&&ce.width(5).height(5),(ee=n.borderWidth)&&ce.css({borderWidth:ee,borderStyle:"solid"}),W(ce,{borderColor1:"border-color",borderColor2:"background-color",borderOpacity:"opacity"})}for(D=n.imageWidth/M||1,R=n.imageHeight/O||1,null!=e.x1&&(l(e.x1,e.y1,e.x2,e.y2),e.show=!e.hide),e.keys&&(n.keys=ge.extend({shift:1,ctrl:"resize"},e.keys)),ae.addClass(n.classPrefix+"-outer"),re.addClass(n.classPrefix+"-selection"),_=0;_++<4;)ge(de[_-1]).addClass(n.classPrefix+"-border"+_);W(re,{selectionColor:"background-color",selectionOpacity:"opacity"}),W(de,{borderOpacity:"opacity",borderWidth:"border-width"}),W(ae,{outerColor:"background-color",outerOpacity:"opacity"}),(ee=n.borderColor1)&&ge(de[0]).css({borderStyle:"solid",borderColor:ee}),(ee=n.borderColor2)&&ge(de[1]).css({borderStyle:"dashed",borderColor:ee}),ne.append(re.add(de).add(K).add(ce)),ge.browser.msie&&((ee=(ae.css("filter")||"").match(/opacity=(\d+)/))&&ae.css("opacity",ee[1]/100),(ee=(de.css("filter")||"").match(/opacity=(\d+)/))&&de.css("opacity",ee[1]/100)),e.hide?m(ne.add(ae)):e.show&&P&&(Y=!0,ne.add(ae).fadeIn(n.fadeSpeed||0),f()),X=(Z=(n.aspectRatio||"").split(/:/))[0]/Z[1],se.add(ae).unbind("mousedown",C),n.disable||!1===n.enable?(ne.unbind("mousemove",b).unbind("mousedown",y),ge(window).unbind("resize",A)):(!n.enable&&!1!==n.disable||((n.resizable||n.movable)&&ne.mousemove(b).mousedown(y),ge(window).resize(A)),n.persistent||se.add(ae).mousedown(C)),n.enable=n.disable=void 0}var P,K,N,H,M,O,E,T,L,D,R,$,j,q,B,F,X,Y,G,J,Q,U,V,Z,_,ee,te,oe,ie,se=ge(o),ne=ye(),re=ye(),de=ye().add(ye()).add(ye()).add(ye()),ae=ye().add(ye()).add(ye()).add(ye()),ce=ge([]),le={left:0,top:0},ue={left:0,top:0},he=0,fe="absolute",me={x1:0,y1:0,x2:0,y2:0,width:0,height:0},be=document.documentElement,pe=function(e){var t,o=n.keys,i=e.keyCode,s=isNaN(o.alt)||!e.altKey&&!e.originalEvent.altKey?!isNaN(o.ctrl)&&e.ctrlKey?o.ctrl:!isNaN(o.shift)&&e.shiftKey?o.shift:isNaN(o.arrows)?10:o.arrows:o.alt;if("resize"==o.arrows||"resize"==o.shift&&e.shiftKey||"resize"==o.ctrl&&e.ctrlKey||"resize"==o.alt&&(e.altKey||e.originalEvent.altKey)){switch(i){case 37:s=-s;case 39:t=xe(G,Q),G=ve(G,Q),Q=xe(t+s,G),g();break;case 38:s=-s;case 40:t=xe(J,U),J=ve(J,U),U=xe(t+s,J),g(!0);break;default:return}w()}else switch(G=ve(G,Q),J=ve(J,U),i){case 37:v(xe(G-s,N),J);break;case 38:v(G,xe(J-s,H));break;case 39:v(G+ve(s,M-r(Q)),J);break;case 40:v(G,J+ve(s,O-d(U)));break;default:return}return!1};for(this.remove=function(){I({disable:!0}),ne.add(ae).remove()},this.getOptions=function(){return n},this.setOptions=I,this.getSelection=c,this.setSelection=l,this.cancelSelection=k,this.update=f,V=se;V.length;)he=xe(he,isNaN(V.css("z-index"))?he:V.css("z-index")),V=V.parent(":not(body)");he=n.zIndex||he,ge.browser.msie&&se.attr("unselectable","on"),ge.imgAreaSelect.keyPress=ge.browser.msie||ge.browser.safari?"keydown":"keypress",ge.browser.opera&&(K=ye().css({width:"100%",height:"100%",position:"absolute",zIndex:he+2||2})),ne.add(ae).css({visibility:"hidden",position:fe,overflow:"hidden",zIndex:he||"0"}),ne.css({zIndex:he+2||2}),re.add(de).css({position:"absolute",fontSize:0}),o.complete||"complete"==o.readyState||!se.is("img")?e():se.one("load",e),!P&&ge.browser.msie&&7<=ge.browser.version&&(o.src=o.src)},ge.fn.imgAreaSelect=function(e){return e=e||{},this.each(function(){ge(this).data("imgAreaSelect")?e.remove?(ge(this).data("imgAreaSelect").remove(),ge(this).removeData("imgAreaSelect")):ge(this).data("imgAreaSelect").setOptions(e):e.remove||(void 0===e.enable&&void 0===e.disable&&(e.enable=!0),ge(this).data("imgAreaSelect",new ge.imgAreaSelect(this,e)))}),e.instance?ge(this).data("imgAreaSelect"):this}};e(),this.resolveWith(e)});