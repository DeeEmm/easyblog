EasyBlog.module("composer/vendors/redactor10",function(h){function n(e,t){return new n.prototype.init(e,t)}Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;return function(){return t.apply(e)}});var i=0;h.fn.composer=function(i){var s=[],r=Array.prototype.slice.call(arguments,1);return"string"==typeof i?this.each(function(){var e,t=h.data(this,"redactor");"-1"!=i.search(/\./)?void 0!==t[(e=i.split("."))[0]]&&(e=t[e[0]][e[1]]):e=t[i],void 0!==t&&h.isFunction(e)?void 0!==(e=e.apply(t,r))&&e!==t&&s.push(e):h.error('No such method "'+i+'" for Redactor')}):this.each(function(){h.data(this,"redactor",{}),h.data(this,"redactor",n(this,i))}),0===s.length?this:1===s.length?s[0]:s},h.Redactor=n,h.Redactor.VERSION="10.0.6",h.Redactor.modules=["alignment","block","buffer","build","caret","clean","core","focus","indent","inline","insert","keydown","keyup","list","paragraphize","paste","selection","shortcuts","tabifier","tidy","utils"],h.Redactor.opts={direction:"ltr",plugins:!1,focus:!1,focusEnd:!1,visual:!0,tabindex:!1,linebreaks:!1,replaceDivs:!0,paragraphize:!0,cleanStyleOnEnter:!1,enterKey:!0,cleanOnPaste:!0,cleanSpaces:!0,pastePlainText:!1,preSpaces:4,tabAsSpaces:!1,tabKey:!0,scrollTarget:!1,formatting:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],formattingAdd:!1,tabifier:!0,deniedTags:["html","head","link","body","meta","script","style","applet"],allowedTags:!1,removeComments:!1,replaceTags:[["strike","del"]],replaceStyles:[["font-weight:\\s?bold","strong"],["font-style:\\s?italic","em"],["text-decoration:\\s?underline","u"],["text-decoration:\\s?line-through","del"]],removeDataAttr:!1,removeAttr:!1,allowedAttr:!1,removeWithoutAttr:["span"],removeEmpty:["p"],shortcuts:{"ctrl+shift+m, meta+shift+m":{func:"inline.removeFormat"},"ctrl+b, meta+b":{func:"inline.format",params:["bold"]},"ctrl+i, meta+i":{func:"inline.format",params:["italic"]},"ctrl+h, meta+h":{func:"inline.format",params:["superscript"]},"ctrl+l, meta+l":{func:"inline.format",params:["subscript"]},"ctrl+shift+7":{func:"list.toggle",params:["orderedlist"]},"ctrl+shift+8":{func:"list.toggle",params:["unorderedlist"]}},shortcutsAdd:!1,buffer:[],rebuffer:[],emptyHtml:"<p>&#x200b;</p>",invisibleSpace:"&#x200b;",imageTypes:["image/png","image/jpeg","image/gif"],indentValue:20,verifiedTags:["a","img","b","strong","sub","sup","i","em","u","small","strike","del","cite","ul","ol","li"],inlineTags:["strong","b","u","em","i","code","del","ins","samp","kbd","sup","sub","mark","var","cite","small"],alignmentTags:["P","H1","H2","H3","H4","H5","H6","DL","DT","DD","DIV","TD","BLOCKQUOTE","OUTPUT","FIGCAPTION","ADDRESS","SECTION","HEADER","FOOTER","ASIDE","ARTICLE"],blockLevelElements:["PRE","UL","OL","LI"]},n.fn=h.Redactor.prototype={keyCode:{BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37,LEFT_WIN:91},init:function(e,t){this.$element=h(e),this.uuid=i++,this.rtePaste=!1,this.$pasteBox=!1,this.loadOptions(t),this.loadModules(),this.formatting={},h.merge(this.opts.blockLevelElements,this.opts.alignmentTags),this.reIsBlock=new RegExp("^("+this.opts.blockLevelElements.join("|")+")$","i"),this.tidy.setupAllowed(),h.extend(this.opts.shortcuts,this.opts.shortcutsAdd),this.core.setCallback("start"),this.start=!0,this.build.run()},loadOptions:function(e){this.opts=h.extend({},h.extend(!0,{},h.Redactor.opts),this.$element.data(),e)},getModuleMethods:function(t){return Object.getOwnPropertyNames(t).filter(function(e){return"function"==typeof t[e]})},loadModules:function(){for(var e=h.Redactor.modules.length,t=0;t<e;t++)this.bindModuleMethods(h.Redactor.modules[t])},bindModuleMethods:function(e){if(void 0!==this[e]){this[e]=this[e]();for(var t=this.getModuleMethods(this[e]),i=t.length,s=0;s<i;s++)this[e][t[s]]=this[e][t[s]].bind(this)}},block:function(){return{formatting:function(e){var t,i;this.block.clearStyle=!1,void 0!==this.formatting[e].data?t="data":void 0!==this.formatting[e].attr?t="attr":void 0!==this.formatting[e].class&&(t="class"),void 0!==this.formatting[e].clear&&(this.block.clearStyle=!0),t&&(i=this.formatting[e][t]),this.block.format(this.formatting[e].tag,t,i)},format:function(e,t,i){-1!=h.inArray(e="quote"==e?"blockquote":e,["p","pre","blockquote","h1","h2","h3","h4","h5","h6"])&&(this.block.isRemoveInline="pre"==e||-1!=e.search(/h[1-6]/i),this.utils.browser("msie")||this.$editor.focus(),this.block.blocks=this.selection.getBlocks(),this.block.blocksSize=this.block.blocks.length,this.block.type=t,this.block.value=i,this.buffer.set(),this.selection.save(),this.block.set(e),this.selection.restore())},set:function(e){this.selection.get(),this.block.containerTag=this.range.commonAncestorContainer.tagName,this.range.collapsed?this.block.setCollapsed(e):this.block.setMultiple(e)},setCollapsed:function(e){var t,i=this.block.blocks[0];if(!1!==i){if("LI"==i.tagName)return"blockquote"!=e?void 0:void this.block.formatListToBlockquote();("TD"==this.block.containerTag||"TH"==this.block.containerTag)&&!this.opts.linebreaks?(document.execCommand("formatblock",!1,"<"+e+">"),i=this.selection.getBlock(),this.block.toggle(h(i))):i.tagName.toLowerCase()!=e?this.opts.linebreaks&&"p"==e?(h(i).prepend("<br>").append("<br>"),this.utils.replaceWithContents(i)):(t=this.utils.replaceToTag(i,e),this.block.toggle(t),"p"!=e&&"blockquote"!=e&&t.find("img").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(t),"p"!=e&&!this.block.headTag||t.find("p").contents().unwrap(),this.block.formatTableWrapping(t)):"blockquote"==e&&i.tagName.toLowerCase()==e?this.opts.linebreaks?(h(i).prepend("<br>").append("<br>"),this.utils.replaceWithContents(i)):(t=this.utils.replaceToTag(i,"p"),this.block.toggle(t)):i.tagName.toLowerCase()==e&&this.block.toggle(h(i))}},setMultiple:function(i){var e,t=this.block.blocks[0],s="TD"==this.block.containerTag||"TH"==this.block.containerTag;if(!1!==t&&1===this.block.blocksSize)t.tagName.toLowerCase()==i&&"blockquote"==i?this.opts.linebreaks?(h(t).prepend("<br>").append("<br>"),this.utils.replaceWithContents(t)):(e=this.utils.replaceToTag(t,"p"),this.block.toggle(e)):"LI"==t.tagName?"blockquote"==i&&this.block.formatListToBlockquote():"BLOCKQUOTE"==this.block.containerTag?this.block.formatBlockquote(i):this.opts.linebreaks&&(s||this.range.commonAncestorContainer!=t)?this.block.formatWrap(i):this.opts.linebreaks&&"p"==i?(h(t).prepend("<br>").append("<br>"),this.utils.replaceWithContents(t)):"TD"===t.tagName?this.block.formatWrap(i):(a=this.utils.replaceToTag(t,i),this.block.toggle(a),this.block.isRemoveInline&&this.utils.removeInlineTags(a),"p"!=i&&!this.block.headTag||a.find("p").contents().unwrap());else if(this.opts.linebreaks||"p"!=i){if("blockquote"==i){for(var r=0,n=0;n<this.block.blocksSize;n++)"BLOCKQUOTE"==this.block.blocks[n].tagName&&r++;if(r==this.block.blocksSize)return void h.each(this.block.blocks,h.proxy(function(e,t){this.opts.linebreaks?(h(t).prepend("<br>").append("<br>"),this.utils.replaceWithContents(t)):this.utils.replaceToTag(t,"p")},this))}this.block.formatWrap(i)}else{var a=0,o=!1;"class"==this.block.type&&(o="toggle",a=h(this.block.blocks).filter("."+this.block.value).size(),this.block.blocksSize==a?o="toggle":(this.block.blocksSize>a||0===a)&&(o="set"));var l=["ul","ol","li","td","th","dl","dt","dd"];h.each(this.block.blocks,h.proxy(function(e,t){-1==h.inArray(t.tagName.toLowerCase(),l)&&(t=this.utils.replaceToTag(t,i),!o||"toggle"==o?this.block.toggle(t):"remove"==o?this.block.remove(t):"set"==o&&this.block.setForce(t),"p"!=i&&"blockquote"!=i&&t.find("img").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(t),"p"!=i&&!this.block.headTag||t.find("p").contents().unwrap())},this))}},setForce:function(e){this.block.clearStyle&&e.removeAttr("class").removeAttr("style"),"class"==this.block.type?e.addClass(this.block.value):"attr"!=this.block.type&&"data"!=this.block.type||e.attr(this.block.value.name,this.block.value.value)},toggle:function(e){this.block.clearStyle&&e.removeAttr("class").removeAttr("style"),"class"==this.block.type?e.toggleClass(this.block.value):"attr"==this.block.type||"data"==this.block.type?e.attr(this.block.value.name)==this.block.value.value?e.removeAttr(this.block.value.name):e.attr(this.block.value.name,this.block.value.value):e.removeAttr("style class")},remove:function(e){e.removeClass(this.block.value)},formatListToBlockquote:function(){var e=h(this.block.blocks[0]).closest("ul, ol");h(e).find("ul, ol").contents().unwrap(),h(e).find("li").append(h("<br>")).contents().unwrap();e=this.utils.replaceToTag(e,"blockquote");this.block.toggle(e)},formatBlockquote:function(e){document.execCommand("outdent"),document.execCommand("formatblock",!1,e),this.clean.clearUnverified(),this.$editor.find("p:empty").remove();var t=this.selection.getBlock();"p"!=e&&h(t).find("img").remove(),this.opts.linebreaks||this.block.toggle(h(t)),this.$editor.find("ul, ol, tr, blockquote, p").each(h.proxy(this.utils.removeEmpty,this)),this.opts.linebreaks&&"p"==e&&this.utils.replaceWithContents(t)},formatWrap:function(e){if("UL"==this.block.containerTag||"OL"==this.block.containerTag){if("blockquote"!=e)return;this.block.formatListToBlockquote()}var t,i=this.selection.wrap(e);!1!==i&&(t=h(i),this.block.formatTableWrapping(t),i=t.find(this.opts.blockLevelElements.join(",")+", td, table, thead, tbody, tfoot, th, tr"),(this.opts.linebreaks&&"p"==e||"pre"==e||"blockquote"==e)&&i.append("<br />"),i.contents().unwrap(),"p"!=e&&"blockquote"!=e&&t.find("img").remove(),h.each(this.block.blocks,h.proxy(this.utils.removeEmpty,this)),t.append(this.selection.getMarker(2)),this.opts.linebreaks||this.block.toggle(t),this.$editor.find("ul, ol, tr, blockquote, p").each(h.proxy(this.utils.removeEmpty,this)),t.find("blockquote:empty").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(t),this.opts.linebreaks&&"p"==e&&this.utils.replaceWithContents(t))},formatTableWrapping:function(e){0!==e.closest("table").size()&&(0===e.closest("tr").size()&&e.wrap("<tr>"),0===e.closest("td").size()&&0===e.closest("th").size()&&e.wrap("<td>"))},removeData:function(e,t){var i=this.selection.getBlocks();h(i).removeAttr("data-"+e)},setData:function(e,t){var i=this.selection.getBlocks();h(i).attr("data-"+e,t)},toggleData:function(e,t){var i=this.selection.getBlocks();h.each(i,function(){h(this).attr("data-"+e)?h(this).removeAttr("data-"+e):h(this).attr("data-"+e,t)})},removeAttr:function(e,t){var i=this.selection.getBlocks();h(i).removeAttr(e)},setAttr:function(e,t){var i=this.selection.getBlocks();h(i).attr(e,t)},toggleAttr:function(e,t){var i=this.selection.getBlocks();h.each(i,function(){h(this).attr(name)?h(this).removeAttr(name):h(this).attr(name,t)})},removeClass:function(e){var t=this.selection.getBlocks();h(t).removeClass(e),this.utils.removeEmptyAttr(t,"class")},setClass:function(e){var t=this.selection.getBlocks();h(t).addClass(e)},toggleClass:function(e){var t=this.selection.getBlocks();h(t).toggleClass(e)}}},buffer:function(){return{set:function(e){void 0===e||"undo"==e?this.buffer.setUndo():this.buffer.setRedo()},setUndo:function(){this.selection.save(),this.opts.buffer.push(this.$editor.html()),this.selection.restore()},setRedo:function(){this.selection.save(),this.opts.rebuffer.push(this.$editor.html()),this.selection.restore()},getUndo:function(){this.$editor.html(this.opts.buffer.pop())},getRedo:function(){this.$editor.html(this.opts.rebuffer.pop())},add:function(){this.opts.buffer.push(this.$editor.html())},undo:function(){0!==this.opts.buffer.length&&(this.buffer.set("redo"),this.buffer.getUndo(),this.selection.restore())},redo:function(){0!==this.opts.rebuffer.length&&(this.buffer.set("undo"),this.buffer.getRedo(),this.selection.restore())}}},build:function(){return{run:function(){this.build.createContainerBox(),this.build.loadEditor(),this.build.enableEditor(),this.build.setCodeAndCall()},createContainerBox:function(){this.$box=this.$element},enableEditor:function(){this.$editor.attr({dir:this.opts.direction})},loadEditor:function(){this.$editor=this.$element},setCodeAndCall:function(){this.build.setOptions(),this.build.callEditor()},callEditor:function(){this.build.disableMozillaEditing(),this.build.setEvents(),this.build.setHelpers(),this.opts.toolbar&&(this.opts.toolbar=this.toolbar.init(),this.toolbar.build()),this.build.plugins(),this.core.setCallback("init")},setOptions:function(){this.opts.linebreaks&&this.$editor.addClass("redactor-linebreaks"),this.opts.tabindex&&this.$editor.attr("tabindex",this.opts.tabindex)},setEvents:function(){this.$editor.on("drop.redactor",h.proxy(function(e){return e=e.originalEvent||e,void 0===window.FormData||!e.dataTransfer||(0===e.dataTransfer.files.length?(setTimeout(h.proxy(this.clean.clearUnverified,this),1),this.core.setCallback("drop",e),!0):(e.preventDefault(),setTimeout(h.proxy(this.clean.clearUnverified,this),1),void this.core.setCallback("drop",e)))},this)),this.$editor.on("click.redactor",h.proxy(function(e){var t="click";"click"!=this.core.getEvent()&&"arrow"!=this.core.getEvent()||(t=!1),this.core.addEvent(t),this.core.setCallback("click",e)},this)),this.$editor.on("paste.redactor",h.proxy(this.paste.init,this)),this.$editor.on("keydown.redactor",h.proxy(this.keydown.init,this)),this.$editor.on("keyup.redactor",h.proxy(this.keyup.init,this)),this.$editor.on("dragstart.redactor",function(e,t){t||(e.preventDefault(),e.stopPropagation())}),h.isFunction(this.opts.focusCallback)&&this.$editor.on("focus.redactor",h.proxy(this.opts.focusCallback,this)),h(document).on("mousedown",function(e){h(e.target)})},setHelpers:function(){this.opts.focus&&setTimeout(h.proxy(this.focus.setStart,this),100),this.opts.focusEnd&&setTimeout(h.proxy(this.focus.setEnd,this),100)},plugins:function(){this.opts.plugins&&RedactorPlugins&&h.each(this.opts.plugins,h.proxy(function(e,t){if(void 0!==RedactorPlugins[t])if(-1===h.inArray(t,h.Redactor.modules)){if(h.isFunction(RedactorPlugins[t])){this[t]=RedactorPlugins[t]();for(var i=this.getModuleMethods(this[t]),s=i.length,r=0;r<s;r++)this[t][i[r]]=this[t][i[r]].bind(this);h.isFunction(this[t].init)&&this[t].init()}}else h.error('Plugin name "'+t+"\" matches the name of the Redactor's module.")},this))},disableMozillaEditing:function(){if(this.utils.browser("mozilla")){document.designMode="on";try{document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1)}catch(e){}document.designMode="off"}}}},caret:function(){return{setStart:function(e){var t;this.utils.isBlock(e)?this.caret.set(e,0,e,0):(t=this.utils.createSpaceElement(),h(e).prepend(t),this.caret.setEnd(t))},setEnd:function(e){this.caret.set(e,1,e,1)},set:function(e,t,i,s){var r;this.utils.browser("msie")||this.$editor.focus(),e=e[0]||e,i=i[0]||i,this.utils.isBlockTag(e.tagName)&&""===e.innerHTML&&(e.innerHTML=this.opts.invisibleSpace),"BR"==e.tagName&&!1===this.opts.linebreaks&&(r=h(this.opts.emptyHtml)[0],h(e).replaceWith(r),i=e=r),this.selection.get();try{this.range.setStart(e,t),this.range.setEnd(i,s)}catch(e){}this.selection.addRange()},setAfter:function(t){try{var e=h(t)[0].tagName;"BR"==e||this.utils.isBlock(t)?"BR"!=e&&this.utils.browser("msie")?this.caret.setStart(h(t).next()):this.caret.setAfterOrBefore(t,"after"):(i=this.utils.createSpaceElement(),h(t).after(i),this.caret.setEnd(i))}catch(e){var i=this.utils.createSpaceElement();h(t).after(i),this.caret.setEnd(i)}},setBefore:function(e){this.utils.isBlock(e)?this.caret.setEnd(h(e).prev()):this.caret.setAfterOrBefore(e,"before")},setAfterOrBefore:function(e,t){if(this.utils.browser("msie")||this.$editor.focus(),e=e[0]||e,this.selection.get(),"after"==t)try{this.range.setStartAfter(e),this.range.setEndAfter(e)}catch(e){}else try{this.range.setStartBefore(e),this.range.setEndBefore(e)}catch(e){}this.range.collapse(!1),this.selection.addRange()},getOffsetOfElement:function(e){e=e[0]||e,this.selection.get();var t=this.range.cloneRange();return t.selectNodeContents(e),t.setEnd(this.range.endContainer,this.range.endOffset),h.trim(t.toString()).length},getOffset:function(){var e,t,i=0;return 0<window.getSelection().rangeCount&&((t=(e=window.getSelection().getRangeAt(0)).cloneRange()).selectNodeContents(this.$editor[0]),t.setEnd(e.endContainer,e.endOffset),i=t.toString().length),i},setOffset:function(e,t){void 0===t&&(t=e),this.focus.isFocused()||this.focus.setStart();this.selection.get();for(var i,s=0,r=document.createTreeWalker(this.$editor[0],NodeFilter.SHOW_TEXT,null,null);i=r.nextNode();)if(e<(s+=i.nodeValue.length)&&(this.range.setStart(i,i.nodeValue.length+e-s),e=1/0),t<=s){this.range.setEnd(i,i.nodeValue.length+t-s);break}this.range.collapse(!1),this.selection.addRange()},setToPoint:function(e,t){this.caret.setOffset(e,t)},getCoords:function(){return this.caret.getOffset()}}},clean:function(){return{onSet:function(e){e=(e=(e=(e=(e=(e=this.clean.savePreCode(e)).replace(/<script(.*?[^>]?)>([\w\W]*?)<\/script>/gi,'<pre class="redactor-script-tag" style="display: none;" $1>$2</pre>')).replace(/\$/g,"&#36;")).replace(/”/g,'"')).replace(/‘/g,"'")).replace(/’/g,"'"),this.opts.replaceDivs&&(e=this.clean.replaceDivs(e)),this.opts.linebreaks&&(e=this.clean.replaceParagraphsToBr(e)),e=this.clean.saveFormTags(e);var t=h("<div>");t.html(e);var i=t.find("font[style]");return 0!==i.length&&(i.replaceWith(function(){var e=h(this);return h("<span>").attr("style",e.attr("style")).append(e.contents())}),e=t.html()),t.remove(),e=(e=e.replace(/<font(.*?[^<])>/gi,"")).replace(/<\/font>/gi,""),e=this.tidy.load(e),this.opts.paragraphize&&(e=this.paragraphize.load(e)),e=this.clean.setVerified(e),e=this.clean.convertInline(e)},onSync:function(i){if(i=(i=i.replace(/[\u200B-\u200D\uFEFF]/g,"")).replace(/&#x200b;/gi,""),-1!=(i=this.opts.cleanSpaces?i.replace(/&nbsp;/gi," "):i).search(/^<p>(||\s||<br\s?\/?>||&nbsp;)<\/p>$/i))return"";i=i.replace(/<pre class="redactor-script-tag" style="display: none;"(.*?[^>]?)>([\w\W]*?)<\/pre>/gi,"<script$1>$2<\/script>"),i=this.clean.restoreFormTags(i);return h.each({"™":"&trade;","©":"&copy;","…":"&hellip;","—":"&mdash;","‐":"&dash;"},function(e,t){i=i.replace(new RegExp(e,"g"),t)}),i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=i.replace(new RegExp("<br\\s?/?></li>","gi"),"</li>")).replace(new RegExp("</li><br\\s?/?>","gi"),"</li>")).replace(new RegExp('<div(.*?[^>]) data-tagblock="redactor"(.*?[^>])>',"gi"),"<div$1$2>")).replace(new RegExp('<(.*?) data-verified="redactor"(.*?[^>])>',"gi"),"<$1$2>")).replace(new RegExp('<span(.*?[^>])srel="(.*?[^>])"(.*?[^>])>',"gi"),"<span$1$3>")).replace(new RegExp('<img(.*?[^>])srel="(.*?[^>])"(.*?[^>])>',"gi"),"<img$1$3>")).replace(new RegExp('<img(.*?[^>])sstyle="" (.*?[^>])>',"gi"),"<img$1 $2>")).replace(new RegExp("<img(.*?[^>])sstyle (.*?[^>])>","gi"),"<img$1 $2>")).replace(new RegExp('<span class="redactor-invisible-space">(.*?)</span>',"gi"),"$1")).replace(/ data-save-url="(.*?[^>])"/gi,"")).replace(/<span(.*?)id="redactor-image-box"(.*?[^>])>([\w\W]*?)<img(.*?)><\/span>/gi,"$3<img$4>")).replace(/<span(.*?)id="redactor-image-resizer"(.*?[^>])>(.*?)<\/span>/gi,"")).replace(/<span(.*?)id="redactor-image-editter"(.*?[^>])>(.*?)<\/span>/gi,"")).replace(/<font(.*?[^<])>/gi,"")).replace(/<\/font>/gi,""),i=this.tidy.load(i),i=(i=(i=(i=(i=(i=this.opts.linkNofollow?(i=i.replace(/<a(.*?)rel="nofollow"(.*?[^>])>/gi,"<a$1$2>")).replace(/<a(.*?[^>])>/gi,'<a$1 rel="nofollow">'):i).replace(/<(.*?) data-redactor-tag="(.*?)"(.*?[^>])>/gi,"<$1$3>")).replace(/<(.*?) data-redactor-class="(.*?)"(.*?[^>])>/gi,"<$1$3>")).replace(/<(.*?) data-redactor-style="(.*?)"(.*?[^>])>/gi,"<$1$3>")).replace(new RegExp('<(.*?) data-verified="redactor"(.*?[^>])>',"gi"),"<$1$2>")).replace(new RegExp('<(.*?) data-verified="redactor">',"gi"),"<$1>")},onPaste:function(e,t){if(e=(e=(e=(e=(e=(e=(e=(e=(e=h.trim(e)).replace(/\$/g,"&#36;")).replace(/”/g,'"')).replace(/“/g,'"')).replace(/‘/g,"'")).replace(/’/g,"'")).replace(/<span class="Apple-converted-space">&nbsp;<\/span>/gi," ")).replace(/<span class="Apple-tab-span"[^>]*>\t<\/span>/gi,"\t")).replace(/<span[^>]*>(\s|&nbsp;)<\/span>/gi," "),this.opts.pastePlainText)return e=this.clean.getPlainText(e),e=this.clean.onPasteTidy(e,"all");if(void 0===t){if(this.utils.isCurrentOrParent(["FIGCAPTION","A"]))return this.clean.getPlainText(e,!1);if(this.utils.isCurrentOrParent("PRE"))return this.clean.getPreCode(e);var i;if(this.utils.isCurrentOrParent(["BLOCKQUOTE","H1","H2","H3","H4","H5","H6"]))return e=this.clean.getOnlyImages(e),e=this.clean.onPasteWord(e),e=this.clean.onPasteExtra(e),e=this.clean.onPasteTidy(e,"all"),this.utils.browser("msie")||(i=this.selection.getBlock())&&"P"==i.tagName&&(e=e.replace(/<img(.*?)>/gi,"<p><img$1></p>")),e;if(this.utils.isCurrentOrParent(["TD"]))return e=this.clean.onPasteTidy(e,"td"),this.opts.linebreaks&&(e=this.clean.replaceParagraphsToBr(e)),e=this.clean.replaceDivsToBr(e);if(this.utils.isCurrentOrParent(["LI"]))return this.clean.onPasteTidy(e,"li")}return e=this.clean.isSingleLine(e,t),this.clean.singleLine||(this.opts.linebreaks&&(e=this.clean.replaceParagraphsToBr(e)),this.opts.replaceDivs&&(e=this.clean.replaceDivs(e)),e=this.clean.saveFormTags(e)),e=this.clean.onPasteWord(e),e=this.clean.onPasteExtra(e),e=this.clean.onPasteTidy(e,"all"),!this.clean.singleLine&&this.opts.paragraphize&&(e=this.paragraphize.load(e)),e=this.clean.removeDirtyStyles(e),e=this.clean.onPasteRemoveSpans(e),e=this.clean.onPasteRemoveEmpty(e),e=this.clean.convertInline(e)},onPasteWord:function(e){return e=(e=e.replace(/<!--[\s\S]*?-->/gi,"")).replace(/<style[^>]*>[\s\S]*?<\/style>/gi,""),/(class=\"?Mso|style=\"[^\"]*\bmso\-|w:WordDocument)/.test(e)&&(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=this.clean.onPasteIeFixLinks(e)).replace(/<img(.*?)v:shapes=(.*?)>/gi,"")).replace(/src="file\:\/\/(.*?)"/,'src=""')).replace(/<p(.*?)class="MsoListParagraphCxSpFirst"([\w\W]*?)<\/p>/gi,"<ul><li$2</li>")).replace(/<p(.*?)class="MsoListParagraphCxSpMiddle"([\w\W]*?)<\/p>/gi,"<li$2</li>")).replace(/<p(.*?)class="MsoListParagraphCxSpLast"([\w\W]*?)<\/p>/gi,"<li$2</li></ul>")).replace(/<p(.*?)class="MsoListParagraph"([\w\W]*?)<\/p>/gi,"<ul><li$2</li></ul>")).replace(/·/g,"")).replace(/<p class="Mso(.*?)"/gi,"<p")).replace(/ class=\"(mso[^\"]*)\"/gi,"")).replace(/ class=(mso\w+)/gi,"")).replace(/<o:p(.*?)>([\w\W]*?)<\/o:p>/gi,"$2")).replace(/\n/g," ")).replace(/<p>\n?<li>/gi,"<li>")),e=this.opts.cleanSpaces?e.replace(/(\s|&nbsp;)+/g," "):e},onPasteExtra:function(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2")).replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3")).replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>/gi,'<span style="font-weight: bold;"><span style="font-style: italic;">')).replace(/<span[^>]*font-style: italic[^>]*>/gi,'<span style="font-style: italic;">')).replace(/<span[^>]*font-weight: bold[^>]*>/gi,'<span style="font-weight: bold;">')).replace(/<span[^>]*text-decoration: underline[^>]*>/gi,'<span style="text-decoration: underline;">')).replace(/<img>/gi,"")).replace(/\n{3,}/gi,"\n")).replace(/<font(.*?)>([\w\W]*?)<\/font>/gi,"$2")).replace(/<p><p>/gi,"<p>")).replace(/<\/p><\/p>/gi,"</p>")).replace(/<li>(\s*|\t*|\n*)<p>/gi,"<li>")).replace(/<\/p>(\s*|\t*|\n*)<\/li>/gi,"</li>")).replace(/<\/p>\s<p/gi,"</p><p")).replace(/<img src="webkit-fake-url\:\/\/(.*?)"(.*?)>/gi,"")).replace(/<p>•([\w\W]*?)<\/p>/gi,"<li>$1</li>"),e=this.utils.browser("mozilla")?e.replace(/<br\s?\/?>$/gi,""):e},onPasteTidy:function(e,t){var i=["span","a","pre","blockquote","small","em","strong","code","kbd","mark","address","cite","var","samp","dfn","sup","sub","b","i","u","del","ol","ul","li","dl","dt","dd","p","br","video","audio","iframe","embed","param","object","img","table","td","th","tr","tbody","tfoot","thead","h1","h2","h3","h4","h5","h6"],s=!1,r=[["a","*"],["img",["src","alt"]],["span",["class","rel","data-verified"]],["iframe","*"],["video","*"],["audio","*"],["embed","*"],["object","*"],["param","*"],["source","*"]];return"all"==t?(s=["p","span","h1","h2","h3","h4","h5","h6"],r=[["table","class"],["td",["colspan","rowspan"]],["a","*"],["img",["src","alt","data-redactor-inserted-image"]],["span",["class","rel","data-verified"]],["iframe","*"],["video","*"],["audio","*"],["embed","*"],["object","*"],["param","*"],["source","*"]]):"td"==t?i=["ul","ol","li","span","a","small","em","strong","code","kbd","mark","cite","var","samp","dfn","sup","sub","b","i","u","del","ol","ul","li","dl","dt","dd","br","iframe","video","audio","embed","param","object","img","h1","h2","h3","h4","h5","h6"]:"li"==t&&(i=["ul","ol","li","span","a","small","em","strong","code","kbd","mark","cite","var","samp","dfn","sup","sub","b","i","u","del","br","iframe","video","audio","embed","param","object","img"]),this.tidy.load(e,{deniedTags:!1,allowedTags:i,removeComments:!0,removePhp:!0,removeAttr:!1,allowedAttr:r,removeEmpty:s})},onPasteRemoveEmpty:function(e){return e=e.replace(/<(p|h[1-6])>(|\s|\n|\t|<br\s?\/?>)<\/(p|h[1-6])>/gi,""),e=!this.opts.linebreaks?e.replace(/<br>$/i,""):e},onPasteRemoveSpans:function(e){return e=(e=e.replace(/<span>(.*?)<\/span>/gi,"$1")).replace(/<span[^>]*>\s|&nbsp;<\/span>/gi," ")},onPasteIeFixLinks:function(e){return this.utils.browser("msie")&&0===h.trim(e).search(/^<a(.*?)>(.*?)<\/a>$/i)?e.replace(/^<a(.*?)>(.*?)<\/a>$/i,"$2"):e},isSingleLine:function(e,t){var i;return this.clean.singleLine=!1,void 0===t&&(i=this.opts.blockLevelElements.join("|").replace("P|","").replace("DIV|",""),t=e.match(new RegExp("</("+i+")>","gi")),i=e.match(/<\/(p|div)>/gi),!t&&(null===i||i&&i.length<=1)&&(t=e.match(/<br\s?\/?>/gi),i=e.match(/<img(.*?[^>])>/gi),t||i||(this.clean.singleLine=!0,e=e.replace(/<\/?(p|div)(.*?)>/gi,"")))),e},stripTags:function(e,i){i=(((i||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return e.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(e,t){return-1<i.indexOf("<"+t.toLowerCase()+">")?e:""})},savePreCode:function(s){var e=s.match(/<(pre|code)(.*?)>([\w\W]*?)<\/(pre|code)>/gi);return null!==e&&h.each(e,h.proxy(function(e,t){var i=t.match(/<(pre|code)(.*?)>([\w\W]*?)<\/(pre|code)>/i);i[3]=i[3].replace(/<br\s?\/?>/g,"\n"),i[3]=i[3].replace(/&nbsp;/g," "),this.opts.preSpaces&&(i[3]=i[3].replace(/\t/g,Array(this.opts.preSpaces+1).join(" "))),i[3]=this.clean.encodeEntities(i[3]),i[3]=i[3].replace(/\$/g,"&#36;"),s=s.replace(t,"<"+i[1]+i[2]+">"+i[3]+"</"+i[1]+">")},this)),s},getTextFromHtml:function(e){e=e.replace(/<br\s?\/?>|<\/H[1-6]>|<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n");var t=document.createElement("div");return t.innerHTML=e,e=t.textContent||t.innerText,h.trim(e)},getPlainText:function(e,t){return e=(e=this.clean.getTextFromHtml(e)).replace(/\n/g,"<br />")},getPreCode:function(e){return e=(e=e.replace(/<img(.*?) style="(.*?)"(.*?[^>])>/gi,"<img$1$3>")).replace(/<img(.*?)>/gi,"&lt;img$1&gt;"),e=this.clean.getTextFromHtml(e),this.opts.preSpaces&&(e=e.replace(/\t/g,Array(this.opts.preSpaces+1).join(" "))),e=this.clean.encodeEntities(e)},getOnlyImages:function(e){return e=(e=(e=e.replace(/<img(.*?)>/gi,"[img$1]")).replace(/<([Ss]*?)>/gi,"")).replace(/\[img(.*?)\]/gi,"<img$1>")},getOnlyLinksAndImages:function(e){return e=(e=(e=(e=(e=e.replace(/<a(.*?)href="(.*?)"(.*?)>([\w\W]*?)<\/a>/gi,'[a href="$2"]$4[/a]')).replace(/<img(.*?)>/gi,"[img$1]")).replace(/<(.*?)>/gi,"")).replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>')).replace(/\[img(.*?)\]/gi,"<img$1>")},encodeEntities:function(e){return(e=String(e).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},removeDirtyStyles:function(e){if(this.utils.browser("msie"))return e;var t=document.createElement("div");return t.innerHTML=e,this.clean.clearUnverifiedRemove(h(t)),e=t.innerHTML,h(t).remove(),e},clearUnverified:function(){this.utils.browser("msie")||this.clean.clearUnverifiedRemove(this.$editor)},clearUnverifiedRemove:function(e){e.find('span[data-verified="redactor"], img[data-verified="redactor"]').each(function(e,t){t=h(t);t.attr("style",t.attr("rel"))})},setVerified:function(e){if(this.utils.browser("msie"))return e;var t=(e=(e=e.replace(new RegExp("<img(.*?[^>])>","gi"),'<img$1 data-verified="redactor">')).replace(new RegExp("<span(.*?)>","gi"),'<span$1 data-verified="redactor">')).match(new RegExp('<(span|img)(.*?)style="(.*?)"(.*?[^>])>',"gi"));if(t)for(var i=t.length,s=0;s<i;s++)try{var r=t[s].replace(/style="(.*?)"/i,'style="$1" rel="$1"');e=e.replace(new RegExp(t[s],"gi"),r)}catch(e){}return e},convertInline:function(e){var t=h("<div />").html(e),i=this.opts.inlineTags;return i.push("span"),t.find(i.join(",")).each(function(){var e=h(this),t=this.tagName.toLowerCase();e.attr("data-redactor-tag",t),"span"==t&&(e.attr("style")?e.attr("data-redactor-style",e.attr("style")):e.attr("class")&&e.attr("data-redactor-class",e.attr("class")))}),e=t.html(),t.remove(),e},normalizeLists:function(){this.$editor.find("li").each(function(e,t){var i=h(t).next();0===i.length||"UL"!=i[0].tagName&&"OL"!=i[0].tagName||h(t).append(i)})},removeSpaces:function(e){return e=(e=(e=(e=(e=(e=(e=(e=e.replace(/\n/g,"")).replace(/[\t]*/g,"")).replace(/\n\s*\n/g,"\n")).replace(/^[\s\n]*/g," ")).replace(/[\s\n]*$/g," ")).replace(/>\s{2,}</g,"> <")).replace(/\n\n/g,"\n")).replace(/[\u200B-\u200D\uFEFF]/g,"")},replaceDivs:function(e){return e=this.opts.linebreaks?(e=e.replace(/<div><br\s?\/?><\/div>/gi,"<br />")).replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"$2<br />"):e.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p$1>$2</p>")},replaceDivsToBr:function(e){return e=(e=(e=e.replace(/<div\s(.*?)>/gi,"<p>")).replace(/<div><br\s?\/?><\/div>/gi,"<br /><br />")).replace(/<div>([\w\W]*?)<\/div>/gi,"$1<br /><br />")},replaceParagraphsToBr:function(e){return e=(e=(e=(e=e.replace(/<p\s(.*?)>/gi,"<p>")).replace(/<p><br\s?\/?><\/p>/gi,"<br />")).replace(/<p>([\w\W]*?)<\/p>/gi,"$1<br /><br />")).replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>")},saveFormTags:function(e){return e.replace(/<form(.*?)>([\w\W]*?)<\/form>/gi,'<section$1 rel="redactor-form-tag">$2</section>')},restoreFormTags:function(e){return e.replace(/<section(.*?) rel="redactor-form-tag"(.*?)>([\w\W]*?)<\/section>/gi,"<form$1$2>$3</form>")}}},core:function(){return{getObject:function(){return h.extend({},this)},getEditor:function(){return this.$editor},getBox:function(){return this.$box},getElement:function(){return this.$element},addEvent:function(e){this.core.event=e},getEvent:function(){return this.core.event},setCallback:function(e,t,i){e=this.opts[e+"Callback"];return h.isFunction(e)?void 0===i?e.call(this,t):e.call(this,t,i):void 0===i?t:i},destroy:function(){this.core.setCallback("destroy"),this.$element.off(".redactor").removeData("redactor"),this.$editor.off(".redactor"),this.$pasteBox&&this.$pasteBox.remove(),h(".redactor-toolbar-tooltip").remove()}}},focus:function(){return{setStart:function(){this.$editor.focus();var e=this.$editor.children().first();if(0!==e.size()&&0!==e[0].length&&"BR"!=e[0].tagName&&3!=e[0].nodeType){if("UL"==e[0].tagName||"OL"==e[0].tagName){var t=(e=e.find("li").first()).children().first();if(!this.utils.isBlock(t)&&""===t.text())return void this.caret.setStart(t)}if(this.opts.linebreaks&&!this.utils.isBlockTag(e[0].tagName))return this.selection.get(),this.range.setStart(this.$editor[0],0),this.range.setEnd(this.$editor[0],0),void this.selection.addRange();this.caret.setStart(e)}},setEnd:function(){if(this.utils.browser("mozilla")||this.utils.browser("msie")){var e=this.$editor.children().last();this.caret.setEnd(e)}else{this.selection.get();try{this.range.selectNodeContents(this.$editor[0]),this.range.collapse(!1),this.selection.addRange()}catch(e){}}},isFocused:function(){var e=document.getSelection().focusNode;return null!==e&&(!!this.utils.isRedactorParent(e.parentNode)&&this.$editor.is(":focus"))}}},indent:function(){return{increase:function(){this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save();var e=this.selection.getBlock();e&&"LI"==e.tagName?this.indent.increaseLists():!1===e&&this.opts.linebreaks?this.indent.increaseText():this.indent.increaseBlocks(),setTimeout(h.proxy(function(){this.selection.restore()},this),1)},increaseLists:function(){document.execCommand("indent"),this.indent.fixEmptyIndent(),this.clean.normalizeLists(),this.clean.clearUnverified()},increaseBlocks:function(){h.each(this.selection.getBlocks(),h.proxy(function(e,t){var i;"TD"!==t.tagName&&"TH"!==t.tagName&&(i=this.utils.getAlignmentElement(t),t=this.utils.normalize(i.css("margin-inline-start"))+this.opts.indentValue,i.css("margin-inline-start",t+"px"))},this))},increaseText:function(){var e=this.selection.wrap("div");h(e).attr("data-tagblock","redactor"),h(e).css("margin-inline-start",this.opts.indentValue+"px")},decrease:function(){this.buffer.set(),this.selection.save();var e=this.selection.getBlock();e&&"LI"==e.tagName?this.indent.decreaseLists():this.indent.decreaseBlocks(),this.selection.restore()},decreaseLists:function(){document.execCommand("outdent");var e=this.selection.getCurrent(),t=h(e).closest("li"),e=t.parent();0!==t.size()&&0!==e.size()&&"LI"==e[0].tagName&&e.after(t),this.indent.fixEmptyIndent(),this.opts.linebreaks||0!==t.size()||(document.execCommand("formatblock",!1,"p"),this.$editor.find("ul, ol, blockquote, p").each(h.proxy(this.utils.removeEmpty,this))),this.clean.clearUnverified()},decreaseBlocks:function(){h.each(this.selection.getBlocks(),h.proxy(function(e,t){var i=this.utils.getAlignmentElement(t),t=this.utils.normalize(i.css("margin-inline-start"))-this.opts.indentValue;t<=0?this.opts.linebreaks&&void 0!==i.data("tagblock")?i.replaceWith(i.html()+"<br />"):(i.css("margin-inline-start",""),this.utils.removeEmptyAttr(i,"style")):i.css("margin-inline-start",t+"px")},this))},fixEmptyIndent:function(){var e=this.selection.getBlock();this.range.collapsed&&e&&"LI"==e.tagName&&this.utils.isEmpty(h(e).text())&&((e=h(e)).find("span").not(".redactor-selection-marker").contents().unwrap(),e.append("<br>"))}}},inline:function(){return{formatting:function(e){var t,i;void 0!==this.formatting[e].style?t="style":void 0!==this.formatting[e].class&&(t="class"),t&&(i=this.formatting[e][t]),this.inline.format(this.formatting[e].tag,t,i)},format:function(e,t,i,s){if(!this.utils.isCurrentOrParent("PRE")){null==s&&(s=!0);for(var r=["b","bold","i","italic","underline","strikethrough","deleted","superscript","subscript"],n=["strong","strong","em","em","u","del","del","sup","sub"],a=0;a<r.length;a++)e==r[a]&&(e=n[a]);this.inline.type=t||!1,this.inline.value=i||!1,this.buffer.set(),this.$editor.focus(),this.selection.get(),this.range.collapsed?this.inline.formatCollapsed(e):this.inline.formatMultiple(e,s)}},formatCollapsed:function(e){var t=this.selection.getCurrent(),t=h(t).closest(e+"[data-redactor-tag="+e+"]");if(0!==t.size())return this.caret.setAfter(t[0]),void(this.utils.isEmpty(t.text())&&t.remove());(e=h("<"+e+">").attr("data-verified","redactor").attr("data-redactor-tag",e)).html(this.opts.invisibleSpace),e=this.inline.setFormat(e);e=this.insert.node(e);this.caret.setEnd(e)},formatMultiple:function(l,e){var i;this.inline.formatConvert(l),(e=null==e?!0:e)&&this.selection.save(),document.execCommand("strikethrough"),this.$editor.find("strike").each(h.proxy(function(e,t){var i,s=h(t),t="";if("span"==l&&"style"==this.inline.type&&(t=this.inline.formatGetSelectionStyling(s,l)),this.inline.formatRemoveSameChildren(s,l),i=this.inline.type?(i=h("<span>").attr("data-redactor-tag",l).attr("data-verified","redactor"),this.inline.setFormat(i)):h("<"+l+">").attr("data-redactor-tag",l).attr("data-verified","redactor"),t&&(t=this.inline.value+"; "+t,i[0].style.cssText=t,i.attr("data-redactor-style",t)),s.replaceWith(i.html(s.contents())),"span"==l){var r=i.parent();if(r&&"SPAN"==r[0].tagName&&"style"==this.inline.type)for(var n=this.inline.value.split(";"),a=0;a<n.length;a++){if(""===n[a])return;var o=n[a].split(":");r.css(o[0],""),this.utils.removeEmptyAttr(r,"style")&&r.replaceWith(r.contents())}}},this)),"span"!=l&&this.$editor.find(this.opts.inlineTags.join(", ")).each(h.proxy(function(e,t){t=h(t);"line-through"==t.css("text-decoration")&&(t.css("text-decoration",""),this.utils.removeEmptyAttr(t,"style"))},this)),"del"!=l&&(i=this).$editor.find("inline").each(function(e,t){i.utils.replaceToTag(t,"del")}),e&&this.selection.restore()},formatGetSelectionStyling:function(e,t){var i="",s=[],t='[data-redactor-tag="'+t+'"][data-redactor-style]',r=this.inline.value.split(":")[0];return e.children(t).each(function(){var e=h(this).data("redactor-style").split(";");h.each(e,function(e,t){-1===t.indexOf(r)&&s.push(t)})}),i=0<s.length?s.join("; "):i},formatRemoveSameChildren:function(e,t){e.children(t).each(function(){var e=h(this);e.hasClass("redactor-selection-marker")||e.contents().unwrap()})},formatConvert:function(t){this.selection.save();var i,s="";"class"==this.inline.type?s="[data-redactor-class="+this.inline.value+"]":"style"==this.inline.type&&(s='[data-redactor-style="'+this.inline.value+'"]'),"del"!=t&&(i=this).$editor.find("del").each(function(e,t){i.utils.replaceToTag(t,"inline")}),this.$editor.find('[data-redactor-tag="'+t+'"]'+s).each(function(){var e;""===s&&"span"==t&&this.tagName.toLowerCase()==t||(e=h(this)).replaceWith(h("<strike />").html(e.contents()))}),this.selection.restore()},setFormat:function(e){switch(this.inline.type){case"class":e.hasClass(this.inline.value)?(e.removeClass(this.inline.value),e.removeAttr("data-redactor-class")):(e.addClass(this.inline.value),e.attr("data-redactor-class",this.inline.value));break;case"style":e[0].style.cssText=this.inline.value,e.attr("data-redactor-style",this.inline.value)}return e},removeStyle:function(){this.buffer.set();var e=this.selection.getCurrent(),t=this.selection.getInlines();this.selection.save(),e&&"SPAN"===e.tagName&&((e=h(e)).removeAttr("style"),0===e[0].attributes.length&&e.replaceWith(e.contents())),h.each(t,h.proxy(function(e,t){var i=h(t);-1==h.inArray(t.tagName.toLowerCase(),this.opts.inlineTags)||i.hasClass("redactor-selection-marker")||(i.removeAttr("style"),0===i[0].attributes.length&&i.replaceWith(i.contents()))},this)),this.selection.restore()},removeStyleRule:function(s){this.buffer.set();var e=this.selection.getParent(),t=this.selection.getInlines();this.selection.save(),e&&"SPAN"===e.tagName&&((e=h(e)).css(s,""),this.utils.removeEmptyAttr(e,"style"),0===e[0].attributes.length&&e.replaceWith(e.contents())),h.each(t,h.proxy(function(e,t){var i=h(t);-1==h.inArray(t.tagName.toLowerCase(),this.opts.inlineTags)||i.hasClass("redactor-selection-marker")||(i.css(s,""),this.utils.removeEmptyAttr(i,"style"),0===i[0].attributes.length&&i.replaceWith(i.contents()))},this)),this.selection.restore()},removeFormat:function(){this.buffer.set();var e=this.selection.getCurrent();this.selection.save(),document.execCommand("removeFormat"),e&&"SPAN"===e.tagName&&h(e).replaceWith(h(e).contents()),h.each(this.selection.getNodes(),h.proxy(function(e,t){var i=h(t);-1==h.inArray(t.tagName.toLowerCase(),this.opts.inlineTags)||i.hasClass("redactor-selection-marker")||i.replaceWith(i.contents())},this)),this.selection.restore()},toggleClass:function(e){this.inline.format("span","class",e)},toggleStyle:function(e,t){this.inline.format("span","style",e,t=null==t?!0:t)}}},insert:function(){return{set:function(e,t){e=this.clean.setVerified(e),void 0===t&&(e=this.clean.onPaste(e,!1)),this.$editor.html(e),this.selection.remove(),this.focus.setEnd(),this.clean.normalizeLists(),void 0===t&&setTimeout(h.proxy(this.clean.clearUnverified,this),10)},text:function(e){if(e=e.toString(),e=h.trim(e),e=this.clean.getPlainText(e,!1),this.$editor.focus(),this.utils.browser("msie"))this.insert.htmlIe(e);else{this.selection.get(),this.range.deleteContents();var t=document.createElement("div");t.innerHTML=e;for(var i,s,r=document.createDocumentFragment();i=t.firstChild;)s=r.appendChild(i);this.range.insertNode(r),s&&((e=this.range.cloneRange()).setStartAfter(s),e.collapse(!0),this.sel.removeAllRanges(),this.sel.addRange(e))}this.clean.clearUnverified()},htmlWithoutClean:function(e){this.insert.html(e,!1)},html:function(e,t){void 0===t&&(t=!0),this.$editor.focus(),e=this.clean.setVerified(e),t&&(e=this.clean.onPaste(e)),this.utils.browser("msie")?this.insert.htmlIe(e):(this.clean.singleLine?this.insert.execHtml(e):document.execCommand("insertHTML",!1,e),this.insert.htmlFixMozilla()),this.clean.normalizeLists(),this.opts.linebreaks||this.$editor.find("p").each(h.proxy(this.utils.removeEmpty,this)),t&&this.clean.clearUnverified()},htmlFixMozilla:function(){var e;!this.utils.browser("mozilla")||0<(e=h(this.selection.getBlock()).next()).length&&"P"==e[0].tagName&&""===e.html()&&e.remove()},htmlIe:function(e){var t,i;this.utils.isIe11()?(t=this.utils.isCurrentOrParent("P"),i=h("<div>").append(e).contents().is("p, :header, dl, ul, ol, div, table, td, blockquote, pre, address, section, header, footer, aside, article"),t&&i?this.insert.ie11FixInserting(t,e):this.insert.ie11PasteFrag(e)):document.selection.createRange().pasteHTML(e)},execHtml:function(e){e=this.clean.setVerified(e),this.selection.get(),this.range.deleteContents();var t=document.createElement("div");t.innerHTML=e;for(var i,s,r=document.createDocumentFragment();i=t.firstChild;)s=r.appendChild(i);this.range.insertNode(r),this.range.collapse(!0),this.caret.setAfter(s)},node:function(e,t){e=e[0]||e;var i=this.utils.getOuterHtml(e),i=this.clean.setVerified(i);return e=h(i)[0],this.selection.get(),!1!==t&&this.range.deleteContents(),this.range.insertNode(e),this.range.collapse(!1),this.selection.addRange(),e},nodeToPoint:function(e,t,i){var s,r;e=e[0]||e,this.selection.get(),document.caretPositionFromPoint?(r=document.caretPositionFromPoint(t,i),this.range.setStart(r.offsetNode,r.offset),this.range.collapse(!0),this.range.insertNode(e)):document.caretRangeFromPoint?(s=document.caretRangeFromPoint(t,i)).insertNode(e):void 0!==document.body.createTextRange&&((s=document.body.createTextRange()).moveToPoint(t,i),(e=s.duplicate()).moveToPoint(t,i),s.setEndPoint("EndToEnd",e),s.select())},nodeToCaretPositionFromPoint:function(e,t){t=t[0]||t;var i,s=e.clientX,r=e.clientY;document.caretPositionFromPoint?(e=document.caretPositionFromPoint(s,r),(i=document.getSelection().getRangeAt(0)).setStart(e.offsetNode,e.offset),i.collapse(!0),i.insertNode(t)):document.caretRangeFromPoint?(i=document.caretRangeFromPoint(s,r)).insertNode(t):void 0!==document.body.createTextRange&&((i=document.body.createTextRange()).moveToPoint(s,r),(t=i.duplicate()).moveToPoint(s,r),i.setEndPoint("EndToEnd",t),i.select())},ie11FixInserting:function(e,t){var i=document.createElement("span");i.className="redactor-ie-paste",this.insert.node(i);i="<p>"+(i=h(e).html()).replace(/<span class="redactor-ie-paste"><\/span>/gi,"</p>"+t+"<p>")+"</p>";h(e).replaceWith(i)},ie11PasteFrag:function(e){this.selection.get(),this.range.deleteContents();var t=document.createElement("div");t.innerHTML=e;for(var i,s=document.createDocumentFragment();i=t.firstChild;)s.appendChild(i);this.range.insertNode(s)}}},keydown:function(){return{init:function(e){if(!h(e.target).is("input, textarea")&&!this.rtePaste){var t,i,s,r=e.which,n=37<=r&&r<=40;if(this.keydown.ctrl=e.ctrlKey||e.metaKey,this.keydown.current=this.selection.getCurrent(),this.keydown.parent=this.selection.getParent(),this.keydown.block=this.selection.getBlock(),this.keydown.pre=this.utils.isTag(this.keydown.current,"pre"),this.keydown.blockquote=this.utils.isTag(this.keydown.current,"blockquote"),this.keydown.figcaption=this.utils.isTag(this.keydown.current,"figcaption"),this.shortcuts.init(e,r),this.keydown.checkEvents(n,r),this.keydown.setupBuffer(e,r),this.keydown.addArrowsEvent(n),!1===this.core.setCallback("keydown",e))return e.preventDefault(),!1;if(!this.opts.enterKey||!this.utils.browser("msie")&&!this.utils.browser("mozilla")||r!==this.keyCode.DOWN&&r!==this.keyCode.RIGHT||(n=t=!1,(n=this.keydown.block&&"TD"===this.keydown.block.tagName?h(this.keydown.block).closest("table"):n)&&n.find("td").last()[0]===this.keydown.block&&(t=!0),this.utils.isEndOfElement()&&t&&(t=h(this.opts.emptyHtml),n.after(t),this.caret.setStart(t))),this.opts.enterKey&&r===this.keyCode.DOWN&&this.keydown.onArrowDown(),!this.opts.enterKey&&r===this.keyCode.ENTER)return e.preventDefault(),void(this.range.collapsed||this.range.deleteContents());if(r==this.keyCode.ENTER&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey){if(!1===this.core.setCallback("enter",e))return e.preventDefault(),!1;if(this.keydown.pre)return this.keydown.insertNewLine(e);if("text"==this.utils.getEditableContentType(this.keydown.block))return i=this.selection.getEndNode(),(0===(s=h(i).next()).size()||"BR"!=s[0].tagName)&&this.utils.isEndOfElement()&&i&&"SPAN"!=i?this.keydown.insertDblBreakLine(e):this.keydown.insertBreakLine(e);if(this.opts.linebreaks&&!this.keydown.block)return i=this.selection.getCurrent(),s=h(this.keydown.current).next(),!1!==i&&h(i).hasClass("redactor-invisible-space")?(h(i).remove(),this.keydown.insertDblBreakLine(e)):0===s.length&&!1===i&&void 0!==s.context?this.keydown.insertDblBreakLine(e):this.keydown.insertBreakLine(e);if(this.opts.linebreaks&&this.keydown.block)setTimeout(h.proxy(this.keydown.replaceDivToBreakLine,this),1);else if(!this.opts.linebreaks&&this.keydown.block&&"LI"!==this.keydown.block.tagName)setTimeout(h.proxy(this.keydown.replaceDivToParagraph,this),1);else if(!this.opts.linebreaks&&!this.keydown.block)return this.keydown.insertParagraph(e)}if(r===this.keyCode.ENTER&&(e.ctrlKey||e.shiftKey))return this.keydown.onShiftEnter(e);r===this.keyCode.BACKSPACE&&(this.keydown.removeInvisibleSpace(),this.keydown.removeEmptyListInTable(e),this.keyup.formatEmpty(e))}},checkEvents:function(e,t){e||"click"!=this.core.getEvent()&&"arrow"!=this.core.getEvent()||(this.core.addEvent(!1),this.keydown.checkKeyEvents(t)&&this.buffer.set())},checkKeyEvents:function(e){var t=this.keyCode,t=[t.BACKSPACE,t.DELETE,t.ENTER,t.SPACE,t.ESC,t.TAB,t.CTRL,t.META,t.ALT,t.SHIFT];return-1==h.inArray(e,t)},addArrowsEvent:function(e){e&&("click"!=this.core.getEvent()&&"arrow"!=this.core.getEvent()?this.core.addEvent("arrow"):this.core.addEvent(!1))},setupBuffer:function(e,t){this.keydown.ctrl&&90===t&&!e.shiftKey&&!e.altKey&&this.opts.buffer.length?(e.preventDefault(),this.buffer.undo()):this.keydown.ctrl&&90===t&&e.shiftKey&&!e.altKey&&0!==this.opts.rebuffer.length?(e.preventDefault(),this.buffer.redo()):this.keydown.ctrl||t!=this.keyCode.BACKSPACE&&t!=this.keyCode.DELETE&&(t!=this.keyCode.ENTER||e.ctrlKey||e.shiftKey)&&t!=this.keyCode.SPACE||this.buffer.set()},onArrowDown:function(){for(var e=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption],t=0;t<e.length;t++)if(e[t])return this.keydown.insertAfterLastElement(e[t]),!1},onShiftEnter:function(e){return this.buffer.set(),this.utils.isEndOfElement()?this.keydown.insertDblBreakLine(e):this.keydown.insertBreakLine(e)},onTab:function(e,t){return!this.opts.tabKey||(e.preventDefault(),this.keydown.pre&&!e.shiftKey||!1!==this.opts.tabAsSpaces?void 0:(e.metaKey&&219===t||(!e.metaKey||221!==t)&&e.shiftKey?this.indent.decrease():this.indent.increase(),!1))},replaceDivToBreakLine:function(){var e=this.selection.getBlock(),t=e.innerHTML.replace(/<br\s?\/?>/gi,"");if(("DIV"===e.tagName||"P"===e.tagName)&&""===t&&!h(e).hasClass("redactor-editor")){t=document.createElement("br");return h(e).replaceWith(t),this.caret.setBefore(t),!1}},replaceDivToParagraph:function(){var e=this.selection.getBlock(),t=e.innerHTML.replace(/<br\s?\/?>/gi,"");if("DIV"===e.tagName&&""===t&&!h(e).hasClass("redactor-editor")){t=document.createElement("p");return t.innerHTML=this.opts.invisibleSpace,h(e).replaceWith(t),this.caret.setStart(t),!1}this.opts.cleanStyleOnEnter&&"P"==e.tagName&&h(e).removeAttr("class").removeAttr("style")},insertParagraph:function(e){e.preventDefault(),this.selection.get();e=document.createElement("p");return e.innerHTML=this.opts.invisibleSpace,this.range.deleteContents(),this.range.insertNode(e),this.caret.setStart(e),!1},exitFromBlockquote:function(e){if(this.utils.isEndOfElement()){var t=h.trim(h(this.keydown.block).html());if(-1!=t.search(/(<br\s?\/?>){2}$/i))return e.preventDefault(),this.opts.linebreaks?(e=document.createElement("br"),h(this.keydown.blockquote).after(e),this.caret.setBefore(e),h(this.keydown.block).html(t.replace(/<br\s?\/?>$/i,""))):(t=h(this.opts.emptyHtml),h(this.keydown.blockquote).after(t),this.caret.setStart(t)),!0}},insertAfterLastElement:function(e){var t,i,s;this.utils.isEndOfElement()&&(this.buffer.set(),this.opts.linebreaks?("SPAN"==(i=(t=h("<div>").append(h.trim(this.$editor.html())).contents()).last()[0]).tagName&&""===i.innerHTML&&(i=t.prev()[0]),this.utils.getOuterHtml(i)==this.utils.getOuterHtml(e)&&(s=document.createElement("br"),h(e).after(s),this.caret.setAfter(s))):this.$editor.contents().last()[0]===e&&(s=h(this.opts.emptyHtml),h(e).after(s),this.caret.setStart(s)))},insertNewLine:function(e){e.preventDefault();e=document.createTextNode("\n");return this.selection.get(),this.range.deleteContents(),this.range.insertNode(e),this.caret.setAfter(e),!1},insertBreakLine:function(e){return this.keydown.insertBreakLineProcessing(e)},insertDblBreakLine:function(e){return this.keydown.insertBreakLineProcessing(e,!0)},insertBreakLineProcessing:function(e,t){e.stopPropagation(),this.selection.get();e=document.createElement("br");return this.range.deleteContents(),this.range.insertNode(e),!0===t?(t=document.createElement("br"),this.range.insertNode(t),this.caret.setAfter(t)):this.caret.setAfter(e),!1},removeInvisibleSpace:function(){var e=h(this.keydown.current);0===e.text().search(/^\u200B$/g)&&e.is(":not([contenteditable])")&&e.remove()},removeEmptyListInTable:function(e){var t=h(this.keydown.current),i=h(this.keydown.parent),s=t.closest("td");0!==s.size()&&t.closest("li")&&1===i.children("li").size()&&this.utils.isEmpty(t.text())&&(e.preventDefault(),t.remove(),i.remove(),this.caret.setStart(s))}}},keyup:function(){return{init:function(e){if(!h(e.target).is("input, textarea")&&!this.rtePaste){var t=e.which;this.keyup.current=this.selection.getCurrent(),this.keyup.parent=this.selection.getParent();var i=this.utils.isRedactorParent(h(this.keyup.parent).parent());if(!1===this.core.setCallback("keyup",e))return e.preventDefault(),!1;if(!this.opts.linebreaks&&3==this.keyup.current.nodeType&&this.keyup.current.length<=1&&(!1===this.keyup.parent||"BODY"==this.keyup.parent.tagName)&&this.keyup.replaceToParagraph(),!this.opts.linebreaks&&this.utils.isRedactorParent(this.keyup.current)&&"DIV"===this.keyup.current.tagName&&this.keyup.replaceToParagraph(!1),this.opts.linebreaks||!h(this.keyup.parent).hasClass("redactor-invisible-space")||!1!==i&&"BODY"!=i[0].tagName||(h(this.keyup.parent).contents().unwrap(),this.keyup.replaceToParagraph()),t===this.keyCode.DELETE||t===this.keyCode.BACKSPACE)return this.clean.clearUnverified(),this.$editor.find("p:not([contenteditable])").each(h.proxy(this.utils.removeEmpty,this)),this.keyup.current&&"DIV"==this.keyup.current.tagName&&this.utils.isEmpty(this.keyup.current.innerHTML)&&this.opts.linebreaks&&(h(this.keyup.current).after(this.selection.getMarkerAsHtml()),this.selection.restore(),h(this.keyup.current).remove()),this.keyup.formatEmpty(e);t=this.utils.getEditableContainer(e.target),e=this.utils.getEditableContentType(e.target),h(t);"text"==e&&""==h(t).text()&&(t.innerHTML=this.opts.invisibleSpace,this.caret.setEnd(t))}},replaceToParagraph:function(e){},formatEmpty:function(e){var t=this.utils.getEditableContainer(e.target),i=this.utils.getEditableContentType(e.target),t=h(t);if("html"===i){i=h.trim(t.html());if(this.utils.isEmpty(i))return e.preventDefault(),this.opts.linebreaks?(t.html(this.selection.getMarkerAsHtml()),this.selection.restore()):((e=document.createElement("p")).innerHTML=this.opts.invisibleSpace,t.empty().append(e),this.caret.setEnd(e)),!1}}}},list:function(){return{toggle:function(e){this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save();var t,i,s=this.selection.getParent(),r=h(s).closest("ol, ul"),n=h(s).closest(EBD.block),s=!1;(r=!this.utils.isRedactorParent(r)&&0!==r.size()?!1:r)&&r.length&&(s=!0,i=r[0].tagName,t="orderedlist"===e&&"UL"===i,i="unorderedlist"===e&&"OL"===i),t?this.utils.replaceToTag(r,"ol"):i?this.utils.replaceToTag(r,"ul"):s?this.list.remove(e):this.list.insert(e),this.$editor.trigger("composerListFormat",[n]),this.selection.restore()},insert:function(e){var t=this.selection.getParent(),i=this.selection.getCurrent(),s=h(i).closest("td, th");this.utils.browser("msie")&&this.opts.linebreaks?this.list.insertInIe(e):document.execCommand("insert"+e);var r,i=h(this.selection.getParent()).closest("ol, ul");0!==s.size()&&(e=s.prev(),r=s.html(),s.html(""),!e||1!==e.length||"TD"!==e[0].tagName&&"TH"!==e[0].tagName?h(t).prepend(s):h(e).after(s),s.html(r)),this.utils.isEmpty(i.find("li").text())&&((r=i.children("li")).find("br").remove(),r.append(this.selection.getMarkerAsHtml())),i.length&&(i=i.parent(),this.utils.isRedactorParent(i)&&"LI"!=i[0].tagName&&this.utils.isBlock(i[0])&&i.replaceWith(i.contents())),this.utils.browser("msie")||this.$editor.focus(),this.clean.clearUnverified()},insertInIe:function(e){var t=this.selection.wrap("div"),i=h(t).html(),s=h("orderedlist"==e?"<ol>":"<ul>"),e=h("<li>");if(""===h.trim(i))e.append(this.selection.getMarkerAsHtml()),s.append(e),this.$editor.find("#selection-marker-1").replaceWith(s);else{var r=i.split(/<br\s?\/?>/gi);if(r)for(var n=0;n<r.length;n++)""!==h.trim(r[n])&&s.append(h("<li>").html(r[n]));else e.append(i),s.append(e);h(t).replaceWith(s)}},remove:function(e){document.execCommand("insert"+e);var t=h(this.selection.getCurrent());this.indent.fixEmptyIndent(),this.opts.linebreaks||0!==t.closest("li, th, td").size()||(document.execCommand("formatblock",!1,"p"),this.$editor.find("ul, ol, blockquote").each(h.proxy(this.utils.removeEmpty,this)));e=h(this.selection.getCurrent()).closest("table"),t=e.prev();this.opts.linebreaks||0===e.size()||0===t.size()||"BR"!=t[0].tagName||t.remove(),this.clean.clearUnverified()}}},paragraphize:function(){return{load:function(e,t){return this.opts.linebreaks?e:""===e||"<p></p>"===e?this.opts.emptyHtml:(this.paragraphize.blocks=["table","div","pre","form","ul","ol","h1","h2","h3","h4","h5","h6","dl","blockquote","figcaption","address","section","header","footer","aside","article","object","style","script","iframe","select","input","textarea","button","option","map","area","math","hr","fieldset","legend","hgroup","nav","figure","details","menu","summary","p"],e+="\n",this.paragraphize.safes=[],this.paragraphize.z=0,e=e.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>"),e=this.paragraphize.getSafes(e),e=this.paragraphize.getSafesComments(e),e=this.paragraphize.replaceBreaksToNewLines(e),e=this.paragraphize.replaceBreaksToParagraphs(e),e=this.paragraphize.clear(e),e=(e=this.paragraphize.restoreSafes(e)).replace(new RegExp("<br\\s?/?>\n?<("+this.paragraphize.blocks.join("|")+")(.*?[^>])>","gi"),"<p><br /></p>\n<$1$2>"),h.trim(e))},getSafes:function(i){var e=h("<div />").append(i);return e.find("blockquote p").replaceWith(function(){return h(this).append("<br />").contents()}),i=e.html(),e.find(this.paragraphize.blocks.join(", ")).each(h.proxy(function(e,t){this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=t.outerHTML,i=i.replace(t.outerHTML,"\n{replace"+this.paragraphize.z+"}")},this)),i},getSafesComments:function(i){var e=i.match(/<!--([\w\W]*?)-->/gi);return e&&h.each(e,h.proxy(function(e,t){this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=t,i=i.replace(t,"\n{replace"+this.paragraphize.z+"}")},this)),i},restoreSafes:function(i){return h.each(this.paragraphize.safes,function(e,t){i=i.replace("{replace"+e+"}",t)}),i},replaceBreaksToParagraphs:function(e){var t=e.split(new RegExp("\n","g"),-1);if(e="",t)for(var i=t.length,s=0;s<i;s++){if(!t.hasOwnProperty(s))return;-1==t[s].search("{replace")?(t[s]=t[s].replace(/<p>\n\t?<\/p>/gi,""),t[s]=t[s].replace(/<p><\/p>/gi,""),""!==t[s]&&(e+="<p>"+t[s].replace(/^\n+|\n+$/g,"")+"</p>")):e+=t[s]}return e},replaceBreaksToNewLines:function(e){return e=(e=(e=(e=(e=e.replace(/<br \/>\s*<br \/>/gi,"\n\n")).replace(/<br\s?\/?>\n?<br\s?\/?>/gi,"\n<br /><br />")).replace(new RegExp("\r\n","g"),"\n")).replace(new RegExp("\r","g"),"\n")).replace(new RegExp("/\n\n+/"),"g","\n\n")},clear:function(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(new RegExp("</blockquote></p>","gi"),"</blockquote>")).replace(new RegExp("<p></blockquote>","gi"),"</blockquote>")).replace(new RegExp("<p><blockquote>","gi"),"<blockquote>")).replace(new RegExp("<blockquote></p>","gi"),"<blockquote>")).replace(new RegExp("<p><p ","gi"),"<p ")).replace(new RegExp("<p><p>","gi"),"<p>")).replace(new RegExp("</p></p>","gi"),"</p>")).replace(new RegExp("<p>\\s?</p>","gi"),"")).replace(new RegExp("\n</p>","gi"),"</p>")).replace(new RegExp("<p>\t?\t?\n?<p>","gi"),"<p>")).replace(new RegExp("<p>\t*</p>","gi"),"")}}},paste:function(){return{init:function(e){var t,i,s,r;h(e.target).is("input, textarea")||this.opts.cleanOnPaste&&(this.rtePaste=!0,this.buffer.set(),this.selection.save(),(r=e.originalEvent.clipboardData)?(t=r.types,s=i="",-1<h.indexOf(t,"text/html")?(i=r.getData("text/html"),s="html"):-1<h.indexOf(t,"text/plain")&&(i=r.getData("text/plain"),s="text"),this.selection.restore(),r=h("<div>").html(i),this.$editor.trigger("composerPaste",[r]),r.find("h1,h2,h3,h4,h5,h6,img,iframe").each(function(){h(this).replaceWith(h(this).text())}),i=r.html(),this.paste.insert(i,s),e.preventDefault()):(this.utils.saveScroll(),this.paste.createPasteBox(),h(window).on("scroll.redactor-freeze",h.proxy(function(){h(window).scrollTop(this.saveBodyScroll)},this)),setTimeout(h.proxy(function(){var e=this.$pasteBox.html();this.$pasteBox.remove(),this.selection.restore(),this.utils.restoreScroll(),this.paste.insert(e),h(window).off("scroll.redactor-freeze")},this),1)))},createPasteBox:function(){this.$pasteBox=h("<div>").html("").attr("contenteditable","true").css({position:"fixed",width:0,top:0,left:"-9999px"}),this.$box.parent().append(this.$pasteBox),this.$pasteBox.focus()},insert:function(e,t){e=this.core.setCallback("pasteBefore",e);var i=this.selection.getCurrent(),i=this.utils.getEditableContentType(i);"text"==(i=null!=t&&""!=t?t:i)&&(this.opts.pastePlainText=!0),e=this.clean.onPaste(e),"text"==i&&(e=this.clean.replaceParagraphsToBr(e)),e=this.core.setCallback("paste",e),this.insert.html(e,!1),this.opts.pastePlainText=!1,this.rtePaste=!1,setTimeout(h.proxy(this.clean.clearUnverified,this),10),setTimeout(h.proxy(function(){var e=this.$editor.find("span");h.each(e,function(e,t){""===t.innerHTML.replace(/[\u200B-\u200D\uFEFF]/,"")&&0===t.attributes.length&&h(t).remove()})},this),10)}}},selection:function(){return{get:function(){return this.sel=document.getSelection(),document.getSelection&&this.sel.getRangeAt&&this.sel.rangeCount?this.range=this.sel.getRangeAt(0):this.range=document.createRange(),this.sel},addRange:function(){try{this.sel.removeAllRanges()}catch(e){}this.sel.addRange(this.range)},getCurrent:function(){var e=!1;return this.selection.get(),this.sel&&0<this.sel.rangeCount&&(e=this.sel.getRangeAt(0).startContainer),this.utils.isRedactorParent(e)},getStartNode:function(){var e=!1;return this.selection.get(),this.sel&&0<this.sel.rangeCount&&(e=this.range.startContainer,/3|4|8/.test(e.nodeType)||(e=e.childNodes[this.range.startOffset])),this.utils.isRedactorParent(e)},getEndNode:function(){var e=!1;return this.sel&&0<this.sel.rangeCount&&(e=this.range.endContainer,/3|4|8/.test(e.nodeType)||(e=e.childNodes[this.range.endOffset])),this.utils.isRedactorParent(e)},getParent:function(e){return!!(e=e||this.selection.getCurrent())&&this.utils.isRedactorParent(h(e).parent()[0])},getBlock:function(e){for(e=e||this.selection.getCurrent();e;){if(this.utils.isBlockTag(e.tagName))return!h(e).hasClass("ebd")&&e;e=e.parentNode}return!1},getInlines:function(e){if(this.selection.get(),this.range&&this.range.collapsed)return!1;var i=[];e=void 0===e?this.selection.getNodes():e;var s=this.opts.inlineTags;return s.push("span"),h.each(e,h.proxy(function(e,t){-1!=h.inArray(t.tagName.toLowerCase(),s)&&i.push(t)},this)),0!==i.length&&i},getBlocks:function(e){if(this.selection.get(),this.range&&this.range.collapsed)return[this.selection.getBlock()];var i=[];return e=void 0===e?this.selection.getNodes():e,h.each(e,h.proxy(function(e,t){return 0!=h(t).parents("div.ebd").size()&&void(this.utils.isBlock(t)&&(this.selection.lastBlock=t,i.push(t)))},this)),0===i.length?[this.selection.getBlock()]:i},getLastBlock:function(){return this.selection.lastBlock},getNodes:function(){this.selection.get();var t=this.selection.getNodesMarker(1),i=this.selection.getNodesMarker(2);this.selection.setNodesMarker(this.range,t,!0),!1===this.range.collapsed?this.selection.setNodesMarker(this.range,i,!1):i=t;var s=[],r=0,n=this;this.$editor.find("*").each(function(){var e;if(this==t?(0!==(e=h(this).parent()).length&&"BODY"!=e[0].tagName&&n.utils.isRedactorParent(e[0])&&s.push(e[0]),s.push(this),r=1):0<r&&(s.push(this),r+=1),this==i)return!1});for(var e=[],a=s.length,o=0;o<a;o++)"nodes-marker-1"!=s[o].id&&"nodes-marker-2"!=s[o].id&&e.push(s[o]);return this.selection.removeNodesMarkers(),e},getNodesInRange:function(e){for(var t=(e=e||this.range).startContainer.childNodes[e.startOffset]||e.endContainer.childNodes[e.endOffset],i=e.startContainer.childNodes[e.startOffset]||e.startContainer,s=e.endContainer.childNodes[e.endOffset]||e.endContainer,r=e.commonAncestorContainer,n=[],a=i.parentNode;a&&(n.push(a),a!=r);a=a.parentNode);for(n.reverse(),a=i;a&&(!t||h(a.parentNode).closest(r)[0])&&(n.push(a),a!=s);a=function(e){if(e.firstChild)return e.firstChild;for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}}(a));return n},getNodesMarker:function(e){return h('<span id="nodes-marker-'+e+'" class="redactor-nodes-marker" data-verified="redactor">'+this.opts.invisibleSpace+"</span>")[0]},setNodesMarker:function(e,t,i){e=e.cloneRange();try{e.collapse(i),e.insertNode(t)}catch(e){}},removeNodesMarkers:function(){h(document).find("span.redactor-nodes-marker").remove(),this.$editor.find("span.redactor-nodes-marker").remove()},fromPoint:function(e,t){this.caret.setOffset(e,t)},wrap:function(e){if(this.selection.get(),this.range.collapsed)return!1;e=document.createElement(e);return e.appendChild(this.range.extractContents()),this.range.insertNode(e),e},selectElement:function(e){this.caret.set(e,0,e,1)},selectAll:function(){this.selection.get(),this.range.selectNodeContents(this.$editor[0]),this.selection.addRange()},remove:function(){this.selection.get(),this.sel.removeAllRanges()},save:function(){this.selection.createMarkers()},createMarkers:function(){this.selection.get();var e,t=this.selection.getMarker(1);this.selection.setMarker(this.range,t,!0),!1===this.range.collapsed&&(e=this.selection.getMarker(2),this.selection.setMarker(this.range,e,!1),this.utils.browser("chrome")&&this.caret.set(t,0,e,0)),this.savedSel=this.$editor.html()},getMarker:function(e){return h('<span id="selection-marker-'+(e=void 0===e?1:e)+'" class="redactor-selection-marker"  data-verified="redactor">'+this.opts.invisibleSpace+"</span>")[0]},getMarkerAsHtml:function(e){return this.utils.getOuterHtml(this.selection.getMarker(e))},setMarker:function(e,t,i){e=e.cloneRange();try{e.collapse(i),e.insertNode(t)}catch(e){this.focus.setStart()}},restore:function(){var e=this.$editor.find("span#selection-marker-1"),t=this.$editor.find("span#selection-marker-2");0!==e.length&&0!==t.length?this.caret.set(e,0,t,0):0!==e.length?this.caret.set(e,0,e,0):this.$editor.focus(),this.selection.removeMarkers(),this.savedSel=!1},removeMarkers:function(){this.$editor.find("span.redactor-selection-marker").remove()},getText:function(){return this.selection.get(),this.sel.toString()},getHtml:function(){var e="";if(this.selection.get(),this.sel.rangeCount){for(var t=document.createElement("div"),i=this.sel.rangeCount,s=0;s<i;++s)t.appendChild(this.sel.getRangeAt(s).cloneContents());e=t.innerHTML}return this.clean.onSync(e)}}},shortcuts:function(){return{init:function(n,e){if(!this.opts.shortcuts)return!n.ctrlKey&&!n.metaKey||66!==e&&73!==e||n.preventDefault(),!1;h.each(this.opts.shortcuts,h.proxy(function(e,t){for(var i=e.split(","),s=i.length,r=0;r<s;r++)"string"==typeof i[r]&&this.shortcuts.handler(n,h.trim(i[r]),h.proxy(function(){var e;"-1"!=t.func.search(/\./)?void 0!==this[(e=t.func.split("."))[0]]&&this[e[0]][e[1]].apply(this,t.params):this[t.func].apply(this,t.params)},this))},this))},handler:function(i,e,t){var s={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"};e=e.toLowerCase().split(" ");var r={8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"}[i.keyCode],n=String.fromCharCode(i.which).toLowerCase(),a="",o={};h.each(["alt","ctrl","meta","shift"],function(e,t){i[t+"Key"]&&r!==t&&(a+=t+"+")}),r&&(o[a+r]=!0),n&&(o[a+n]=!0,o[a+s[n]]=!0,"shift+"===a&&(o[s[n]]=!0));for(var l=0,c=e.length;l<c;l++)if(o[e[l]])return i.preventDefault(),t.apply(this,arguments)}}},tabifier:function(){return{get:function(e){if(!this.opts.tabifier)return e;var t=["area","body","head","hr","i?frame","link","meta","noscript","style","script","table","tbody","thead","tfoot"],i=["li","dt","dt","h[1-6]","option","script"];this.tabifier.lineBefore=new RegExp("^<(/?"+t.join("|/?")+"|"+i.join("|")+")[ >]"),this.tabifier.lineAfter=new RegExp("^<(br|/?"+t.join("|/?")+"|/"+i.join("|/")+")[ >]"),this.tabifier.newLevel=new RegExp("^</?("+["blockquote","div","dl","fieldset","form","frameset","map","ol","p","pre","select","td","th","tr","ul"].join("|")+")[ >]");var s,r,n=0,a=e.length,o=0,l="",c="",h="";for(this.tabifier.cleanlevel=0;n<a;n++){if(o=n,-1==e.substr(n).indexOf("<"))return c+=e.substr(n),this.tabifier.finish(c);for(;o<a&&"<"!=e.charAt(o);)o++;for(n!=o&&((h=e.substr(n,o-n)).match(/^\s{2,}$/g)||("\n"==c.charAt(c.length-1)?c+=this.tabifier.getTabs():"\n"==h.charAt(0)&&(c+="\n"+this.tabifier.getTabs(),h=h.replace(/^\s+/,"")),c+=h),h.match(/\n/)&&(c+="\n"+this.tabifier.getTabs())),s=o;o<a&&">"!=e.charAt(o);)o++;var p,n=o;if("!--"==(l=e.substr(s,o-s)).substr(1,3)){if(!l.match(/--$/)){for(;"--\x3e"!=e.substr(o,3);)o++;o+=2,l=e.substr(s,o-s),n=o}"\n"!=c.charAt(c.length-1)&&(c+="\n"),c+=this.tabifier.getTabs(),c+=l+">\n"}else"!"==l[1]?c=this.tabifier.placeTag(l+">",c):"?"==l[1]?c+=l+">\n":(p=l.match(/^<(script|style|pre)/i))?(p[1]=p[1].toLowerCase(),l=this.tabifier.cleanTag(l),c=this.tabifier.placeTag(l,c),(r=String(e.substr(n+1)).toLowerCase().indexOf("</"+p[1]))&&(h=e.substr(n+1,r),n+=r,c+=h)):(l=this.tabifier.cleanTag(l),c=this.tabifier.placeTag(l,c))}return this.tabifier.finish(c)},getTabs:function(){for(var e="",t=0;t<this.tabifier.cleanlevel;t++)e+="\t";return e},finish:function(e){return e=(e=(e=(e=e.replace(/\n\s*\n/g,"\n")).replace(/^[\s\n]*/,"")).replace(/[\s\n]*$/,"")).replace(/<script(.*?)>\n<\/script>/gi,"<script$1><\/script>"),this.tabifier.cleanlevel=0,e},cleanTag:function(e){var t,i="",s="";for((e=(e=(e=e.replace(/\n/g," ")).replace(/\s{2,}/g," ")).replace(/^\s+|\s+$/g," ")).match(/\/$/)&&(s="/",e=e.replace(/\/+$/,""));t=/\s*([^= ]+)(?:=((['"']).*?\3|[^ ]+))?/.exec(e);)t[2]?i+=t[1].toLowerCase()+"="+t[2]:t[1]&&(i+=t[1].toLowerCase()),i+=" ",e=e.substr(t[0].length);return i.replace(/\s*$/,"")+s+">"},placeTag:function(e,t){var i=e.match(this.tabifier.newLevel);return(e.match(this.tabifier.lineBefore)||i)&&(t=t.replace(/\s*$/,""),t+="\n"),i&&"/"==e.charAt(1)&&this.tabifier.cleanlevel--,"\n"==t.charAt(t.length-1)&&(t+=this.tabifier.getTabs()),i&&"/"!=e.charAt(1)&&this.tabifier.cleanlevel++,t+=e,(e.match(this.tabifier.lineAfter)||e.match(this.tabifier.newLevel))&&(t=t.replace(/ *$/,""),t+="\n"),t}}},tidy:function(){return{setupAllowed:function(){var e;this.opts.allowedTags&&(this.opts.deniedTags=!1),this.opts.allowedAttr&&(this.opts.removeAttr=!1),this.opts.linebreaks||(e=["p","section"],this.opts.allowedTags&&this.tidy.addToAllowed(e),this.opts.deniedTags&&this.tidy.removeFromDenied(e))},addToAllowed:function(e){for(var t=e.length,i=0;i<t;i++)-1==h.inArray(e[i],this.opts.allowedTags)&&this.opts.allowedTags.push(e[i])},removeFromDenied:function(e){for(var t=e.length,i=0;i<t;i++){var s=h.inArray(e[i],this.opts.deniedTags);-1!=s&&this.opts.deniedTags.splice(s,1)}},load:function(e,t){return this.tidy.settings={deniedTags:this.opts.deniedTags,allowedTags:this.opts.allowedTags,removeComments:this.opts.removeComments,replaceTags:this.opts.replaceTags,replaceStyles:this.opts.replaceStyles,removeDataAttr:this.opts.removeDataAttr,removeAttr:this.opts.removeAttr,allowedAttr:this.opts.allowedAttr,removeWithoutAttr:this.opts.removeWithoutAttr,removeEmpty:this.opts.removeEmpty},h.extend(this.tidy.settings,t),e=this.tidy.removeComments(e),this.tidy.$div=h("<div />").append(e),this.tidy.replaceTags(),this.tidy.replaceStyles(),this.tidy.removeTags(),this.tidy.removeAttr(),this.tidy.removeEmpty(),this.tidy.removeParagraphsInLists(),this.tidy.removeDataAttr(),this.tidy.removeWithoutAttr(),e=this.tidy.$div.html(),this.tidy.$div.remove(),e},removeComments:function(e){return this.tidy.settings.removeComments?e.replace(/<!--[\s\S]*?-->/gi,""):e},replaceTags:function(e){if(!this.tidy.settings.replaceTags)return e;for(var t=this.tidy.settings.replaceTags.length,i=[],s=[],r=0;r<t;r++)s.push(this.tidy.settings.replaceTags[r][1]),i.push(this.tidy.settings.replaceTags[r][0]);return this.tidy.$div.find(i.join(",")).each(h.proxy(function(e,t){var i=s[e];h(t).replaceWith(function(){for(var e=h("<"+i+" />").append(h(this).contents()),t=0;t<this.attributes.length;t++)e.attr(this.attributes[t].name,this.attributes[t].value);return e})},this)),e},replaceStyles:function(){var a;this.tidy.settings.replaceStyles&&(a=this.tidy.settings.replaceStyles.length,this.tidy.$div.find("span").each(h.proxy(function(e,t){for(var i,s=h(t),r=s.attr("style"),n=0;n<a;n++)r&&r.match(new RegExp("^"+this.tidy.settings.replaceStyles[n][0],"i"))&&(i=this.tidy.settings.replaceStyles[n][1],s.replaceWith(function(){var e=document.createElement(i);return h(e).append(h(this).contents())}))},this)))},removeTags:function(){!this.tidy.settings.deniedTags&&this.tidy.settings.allowedTags&&this.tidy.$div.find("*").not(this.tidy.settings.allowedTags.join(",")).each(function(e,t){""===t.innerHTML?h(t).remove():h(t).contents().unwrap()}),this.tidy.settings.deniedTags&&this.tidy.$div.find(this.tidy.settings.deniedTags.join(",")).each(function(e,t){""===t.innerHTML?h(t).remove():h(t).contents().unwrap()})},removeAttr:function(){if(!this.tidy.settings.removeAttr&&this.tidy.settings.allowedAttr){for(var s=[],r=[],e=this.tidy.settings.allowedAttr.length,t=0;t<e;t++)s.push(this.tidy.settings.allowedAttr[t][0]),r.push(this.tidy.settings.allowedAttr[t][1]);this.tidy.$div.find("*").each(h.proxy(function(e,t){var i=h(t),t=h.inArray(i[0].tagName.toLowerCase(),s),t=this.tidy.removeAttrGetRemoves(t,r,i);t&&h.each(t,function(e,t){i.removeAttr(t)})},this))}if(this.tidy.settings.removeAttr){e=this.tidy.settings.removeAttr.length;for(t=0;t<e;t++){var i=this.tidy.settings.removeAttr[t][1];h.isArray(i)&&(i=i.join(" ")),this.tidy.$div.find(this.tidy.settings.removeAttr[t][0]).removeAttr(i)}}},removeAttrGetRemoves:function(i,s,e){var r=[];return-1==i?h.each(e[0].attributes,function(e,t){r.push(t.name)}):"*"==s[i]?r=[]:h.each(e[0].attributes,function(e,t){h.isArray(s[i])?-1==h.inArray(t.name,s[i])&&r.push(t.name):s[i]!=t.name&&r.push(t.name)}),r},removeAttrs:function(e,s){return s=new RegExp(s,"g"),e.each(function(){for(var e=h(this),t=this.attributes.length-1;0<=t;t--){var i=this.attributes[t];i&&i.specified&&0<=i.name.search(s)&&e.removeAttr(i.name)}})},removeEmpty:function(){this.tidy.settings.removeEmpty&&this.tidy.$div.find(this.tidy.settings.removeEmpty.join(",")).each(function(){var e=h(this),t=e.text();""===(t=(t=(t=t.replace(/[\u200B-\u200D\uFEFF]/g,"")).replace(/&nbsp;/gi,"")).replace(/\s/g,""))&&0===e.children().length&&e.remove()})},removeParagraphsInLists:function(){this.tidy.$div.find("li p").contents().unwrap()},removeDataAttr:function(){var e;this.tidy.settings.removeDataAttr&&(e=this.tidy.settings.removeDataAttr,h.isArray(this.tidy.settings.removeDataAttr)&&(e=this.tidy.settings.removeDataAttr.join(",")),this.tidy.removeAttrs(this.tidy.$div.find(e),"^(data-)"))},removeWithoutAttr:function(){this.tidy.settings.removeWithoutAttr&&this.tidy.$div.find(this.tidy.settings.removeWithoutAttr.join(",")).each(function(){0===this.attributes.length&&h(this).contents().unwrap()})}}},utils:function(){return{isMobile:function(){return/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)},isDesktop:function(){return!/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)},isString:function(e){return"[object String]"==Object.prototype.toString.call(e)},isEmpty:function(e,t){return e=(e=(e=(e=(e=(e=e.replace(/[\u200B-\u200D\uFEFF]/g,"")).replace(/&nbsp;/gi,"")).replace(/<\/?br\s?\/?>/g,"")).replace(/\s/g,"")).replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,"")).replace(/<iframe(.*?[^>])>$/i,"iframe"),!1!==t&&(e=(e=e.replace(/<[^\/>][^>]*><\/[^>]+>/gi,"")).replace(/<[^\/>][^>]*><\/[^>]+>/gi,"")),""===(e=h.trim(e))},normalize:function(e){return void 0===e?0:parseInt(e.replace("px",""),10)},hexToRgb:function(e){if(void 0!==e){if(-1==e.search(/^#/))return e;e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,i,s){return t+t+i+i+s+s});e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return"rgb("+parseInt(e[1],16)+", "+parseInt(e[2],16)+", "+parseInt(e[3],16)+")"}},getOuterHtml:function(e){return h("<div>").append(h(e).eq(0).clone()).html()},getAlignmentElement:function(e){return-1!==h.inArray(e.tagName,this.opts.alignmentTags)?h(e):h(e).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0])},removeEmptyAttr:function(e,t){e=h(e);return void 0===e.attr(t)||""===e.attr(t)&&(e.removeAttr(t),!0)},removeEmpty:function(e,t){var i=h(t);i.find(".redactor-invisible-space").removeAttr("style").removeAttr("class"),0===i.find("hr, br, img, iframe").length&&(t=h.trim(i.text()),this.utils.isEmpty(t,!1)&&i.remove())},saveScroll:function(){this.saveEditorScroll=this.$editor.scrollTop(),this.saveBodyScroll=h(window).scrollTop(),this.opts.scrollTarget&&(this.saveTargetScroll=h(this.opts.scrollTarget).scrollTop())},restoreScroll:function(){void 0===this.saveScroll&&void 0===this.saveBodyScroll||(h(window).scrollTop(this.saveBodyScroll),this.$editor.scrollTop(this.saveEditorScroll),this.opts.scrollTarget&&h(this.opts.scrollTarget).scrollTop(this.saveTargetScroll))},createSpaceElement:function(){var e=document.createElement("span");return e.className="redactor-invisible-space",e.innerHTML=this.opts.invisibleSpace,e},removeInlineTags:function(e){var t=this.opts.inlineTags;t.push("span"),"PRE"==e.tagName&&t.push("a"),h(e).find(t.join(",")).not("span.redactor-selection-marker").contents().unwrap()},replaceWithContents:function(e,t){var i=this;h(e).replaceWith(function(){return!0===t&&i.utils.removeInlineTags(this),h(this).contents()})},replaceToTag:function(e,t,i){var s,r=this;return h(e).replaceWith(function(){s=h("<"+t+" />").append(h(this).contents());for(var e=0;e<this.attributes.length;e++)s.attr(this.attributes[e].name,this.attributes[e].value);return!0===i&&r.utils.removeInlineTags(s),s}),s},isStartOfElement:function(){var e=this.selection.getBlock();return!!e&&0===this.caret.getOffsetOfElement(e)},isEndOfElement:function(){var e=this.selection.getBlock();return!!e&&this.caret.getOffsetOfElement(e)==h.trim(h(e).text()).replace(/\n\r\n/g,"").length},isBlock:function(e){return(e=e[0]||e)&&this.utils.isBlockTag(e.tagName)},isBlockTag:function(e){return void 0!==e&&this.reIsBlock.test(e)},isTag:function(e,t){t=h(e).closest(t);return 1==t.size()&&t[0]},isRedactorParent:function(e){return!!e&&(0!==h(e).parents(".ebd").length&&!h(e).hasClass("ebd")&&e)},isCurrentOrParentHeader:function(){return this.utils.isCurrentOrParent(["H1","H2","H3","H4","H5","H6"])},isCurrentOrParent:function(e){var i=this.selection.getParent(),s=this.selection.getCurrent();if(h.isArray(e)){var r=0;return h.each(e,h.proxy(function(e,t){this.utils.isCurrentOrParentOne(s,i,t)&&r++},this)),0!==r}return this.utils.isCurrentOrParentOne(s,i,e)},isCurrentOrParentOne:function(e,t,i){return i=i.toUpperCase(),t&&t.tagName===i?t:!(!e||e.tagName!==i)&&e},isOldIe:function(){return!!(this.utils.browser("msie")&&parseInt(this.utils.browser("version"),10)<9)},isLessIe10:function(){return!!(this.utils.browser("msie")&&parseInt(this.utils.browser("version"),10)<10)},isIe11:function(){return!!navigator.userAgent.match(/Trident\/7\./)},browser:function(e){var t=navigator.userAgent.toLowerCase(),t=/(opr)[\/]([\w.]+)/.exec(t)||/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||0<=t.indexOf("trident")&&/(rv)(?::| )([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return"version"==e?t[2]:"webkit"==e?"chrome"==t[1]||"webkit"==t[1]:"rv"==t[1]?"msie"==e:"opr"==t[1]?"webkit"==e:e==t[1]},getEditableContainer:function(e){e=h(e).parentsUntil(this.$editor).andSelf().closest("[contenteditable=true]")[0];return this.utils.isRedactorParent(e)},isEditableContent:function(e){return!!this.utils.getEditableContainer(e)},getEditableContentType:function(e){e=this.utils.getEditableContainer(e),e=h(e).attr("data-content-type");return"html"==e?"html":"text"}}}},n.prototype.init.prototype=n.prototype,this.resolve()});